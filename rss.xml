<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Gatsby Starter Blog RSS Feed]]></title><description><![CDATA[Maintainer of tesseract.js and ffmpeg.wasm. Here is my Personal writings about software technologies]]></description><link>https://jeromewu.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 01 Sep 2022 13:49:20 GMT</lastBuildDate><item><title><![CDATA[Improving performance using WebAssembly SIMD Intrinsics]]></title><description><![CDATA[WebAssembly is a technology famous of boosting performance of web applications,
but what might be the best practice to do achieve maximum…]]></description><link>https://jeromewu.github.io/improving-performance-using-webassembly-simd-intrinsics/</link><guid isPermaLink="false">https://jeromewu.github.io/improving-performance-using-webassembly-simd-intrinsics/</guid><pubDate>Fri, 26 Aug 2022 12:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9356b5cd4ee6e8beba075ef0abd5af2f/1307b/wa-logo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6UlEQVQ4y42TQWtTQRDHNzZfpuBREEFti9pKNLuv0ZrYZ9Wku7UpesgTDw8VtGhBL0VUPFr15qWnHhTxULx4UERF/BJ5MyStSbrhjey8p7xLkww8Znbff37M7uwIkTEtQWgFOa1QaInCsAf22dj9Y43TShD7mpZwgKESjmoJ61rBmpZwLwO8n+6tpxrOGQDEfCoKtUIyCklL98GGlvDKxZm9MNFifn+gwrxWDGykyR2tsG8UMMgo6BvJe8Qap1VDgXy8QEuGWONhvOQ5KPbT2CZVQpDc+QhAJ3ZJtbNgrxYgvnIaqFoAcvHCNNikWgz4XkcBXith4CCPw7Z98Wgn3ni6S88e7tDLJ7vxx60uAxeLEFTPcNdHAM4mwAc32/bzdi/+9c3S1tsObb7pxD++7Nnbyy2qTEZBZTJypxneFONhY7EIdL2M3d/frf30oWe33/fsu82u/fl1r/v6+R+Sh5qNmYPNIRWmz8YoDLkpHtLarTbdqbdctXR3pUU3KkirjRZdnoHw0ikQS7ODgbn02YwbhTUtYf7C8cj3T4Bfnoh8/yT41QLMX5yKasslHK+f4wbmBk3K/3HiDhZBeIebYu5YJEpHIlGeiMTCNPC6fh7FyhwOGT1+qFyhq3TMKBj757Ox86mG9Vn7C1aJgk5gelXsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;WebAssembly Logo&quot;
        title=&quot;WebAssembly Logo&quot;
        src=&quot;/static/9356b5cd4ee6e8beba075ef0abd5af2f/f058b/wa-logo.png&quot;
        srcset=&quot;/static/9356b5cd4ee6e8beba075ef0abd5af2f/c26ae/wa-logo.png 158w,
/static/9356b5cd4ee6e8beba075ef0abd5af2f/6bdcf/wa-logo.png 315w,
/static/9356b5cd4ee6e8beba075ef0abd5af2f/f058b/wa-logo.png 630w,
/static/9356b5cd4ee6e8beba075ef0abd5af2f/40601/wa-logo.png 945w,
/static/9356b5cd4ee6e8beba075ef0abd5af2f/78612/wa-logo.png 1260w,
/static/9356b5cd4ee6e8beba075ef0abd5af2f/1307b/wa-logo.png 3000w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;WebAssembly is a technology famous of boosting performance of web applications,
but what might be the best practice to do achieve maximum performance and what
is the cost is what we are going to discuss in this post.&lt;/p&gt;
&lt;p&gt;To begin with, let’s talk about how developers develop WebAssembly applications based
on the result of &lt;a href=&quot;https://blog.scottlogic.com/2022/06/20/state-of-wasm-2022.html&quot;&gt;The State of WebAssembly
2022&lt;/a&gt;. The top 3
languages used to develop WebAssembly are Rust, JavaScript and C/C++.
(JavaScript come in second place due to QuickJS, a tiny JS VM, is ported to
WebAssembly and boosts JavaScript runtime performance) As Rust and C/C++ are
top languages, it is common that developers develop Rust or C/C++
programs and compile to WebAssembly.&lt;/p&gt;
&lt;p&gt;Take C/C++ as an example, usually you might use GCC to compile like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gcc -o main main.c&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When you want to compile to WebAssembly, you might use &lt;a href=&quot;https://emscripten.org/&quot;&gt;Emscripten&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;emcc -o main.js main.c
&lt;span class=&quot;token comment&quot;&gt;# or&lt;/span&gt;
emcc -o main.wasm main.c&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then you can use NodeJS or runtime like wasmtime or wasmer to run the program.&lt;/p&gt;
&lt;p&gt;But is that the end of the story? Maybe not. Let’s use a &lt;a href=&quot;https://en.wikipedia.org/wiki/Matrix_multiplication&quot;&gt;matrix
multiplication&lt;/a&gt;
as example to benchmark:&lt;/p&gt;
&lt;p&gt;JavaScript Version (&lt;a href=&quot;https://github.com/jeromewu/wasm-perf/blob/main/mul_mats.js&quot;&gt;Source Code&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// in_b is transposed to speed up multiplication.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mulMats&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;out&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; in_a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; in_b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; k&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; in_a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; in_b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;C Version (&lt;a href=&quot;https://github.com/jeromewu/wasm-perf/blob/main/mul_mats.c&quot;&gt;Source Code&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// in_b is transposed to speed up multiplication.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;multiply_mats&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; out&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; in_a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; in_b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      out&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; k&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        out&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; in_a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; in_b&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The performance of JavaScript version, C version and WebAssembly version:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Version&lt;/th&gt;
&lt;th&gt;Time to Complete&lt;/th&gt;
&lt;th&gt;Remark&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;JavaScript&lt;/td&gt;
&lt;td&gt;5.768s&lt;/td&gt;
&lt;td&gt;NodeJS v16.16.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;7.697s&lt;/td&gt;
&lt;td&gt;GCC 12.2.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebAssembly&lt;/td&gt;
&lt;td&gt;6.865s&lt;/td&gt;
&lt;td&gt;Emscripten 3.1.18&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;It might be unexpected to see that JavaScript version is the fastest one, it is
simply because this is NOT a fair comparison as we didn’t use flags to optimize
performance.&lt;/p&gt;
&lt;p&gt;One of the most significant flag we can use here is &lt;code class=&quot;language-text&quot;&gt;-O3&lt;/code&gt;, let’s add this flag
and below is the result:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Version&lt;/th&gt;
&lt;th&gt;Time to Complete&lt;/th&gt;
&lt;th&gt;Remark&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;JavaScript&lt;/td&gt;
&lt;td&gt;5.768s&lt;/td&gt;
&lt;td&gt;NodeJS v16.16.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;0.401s&lt;/td&gt;
&lt;td&gt;GCC 12.2.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebAssembly&lt;/td&gt;
&lt;td&gt;2.012s&lt;/td&gt;
&lt;td&gt;Emscripten 3.1.18&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;With a simple flag, now WebAssembly version is around 65% faster!&lt;/p&gt;
&lt;p&gt;But how might we improve the performance even more? Let’s discuss what options
we have.&lt;/p&gt;
&lt;h2&gt;Methods to Improve Performance&lt;/h2&gt;
&lt;p&gt;There are mainly three approaches to improve performance:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;More optimization flags&lt;/li&gt;
&lt;li&gt;Use multi-thread&lt;/li&gt;
&lt;li&gt;Use SIMD intrinsics&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;More optimization flags&lt;/h3&gt;
&lt;p&gt;More optimization flags like &lt;code class=&quot;language-text&quot;&gt;-flto&lt;/code&gt; might improve performance, but sometimes it
might introduce side effects, so it is essential to do more tests when using
more flags.&lt;/p&gt;
&lt;h3&gt;Use multi-thread&lt;/h3&gt;
&lt;p&gt;WebAssembly supports multi-thread, so you can use libraries like pthread to
achieve multi-threading. It works but with a major drawback: SharedArrayBuffer.&lt;/p&gt;
&lt;p&gt;SharedArrayBuffer is an essential technology behind multi-threading in
WebAssembly. It enables threads (which is web worker in browser) to communicate
with each other. But it also consumes more memory and suffers from browser
compatibility issue. (Mainly mobile browsers)&lt;/p&gt;
&lt;p&gt;SharedArrayBuffer compatibility: &lt;a href=&quot;https://caniuse.com/sharedarraybuffer&quot;&gt;https://caniuse.com/sharedarraybuffer&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Use SIMD intrinsics&lt;/h3&gt;
&lt;p&gt;SIMD (Single Instruction, Multiple Data) is a type of parallel processing
supported by WebAssembly. In Emscripten, you can add flag &lt;code class=&quot;language-text&quot;&gt;-msimd128&lt;/code&gt; to
enable SIMD and improve performance for free:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Version&lt;/th&gt;
&lt;th&gt;Time to Complete&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;JavaScript&lt;/td&gt;
&lt;td&gt;5.768s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;0.401s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebAssembly&lt;/td&gt;
&lt;td&gt;2.012s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebAssembly (w/ -msimd128)&lt;/td&gt;
&lt;td&gt;0.278s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;-O3&lt;/code&gt; flag comes with auto-vectorization, so it is better to use &lt;code class=&quot;language-text&quot;&gt;-msimd128&lt;/code&gt;
with &lt;code class=&quot;language-text&quot;&gt;-O3&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Wow, now our performance is so good that it is even faster than C version! But
it is not the end of the story as we haven’t used our secret weapon: &lt;strong&gt;SIMD
intrinsics&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;SIMD intrinsics are low-level functions to enable developers to write assembly
code in a more user-friendly way. It is supported not only in Emscripten, but
also other major languages like Rust and AssemblyScript. With SIMD intrinsics,
we can rewrite our code to improve performance further more:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// in_b is transposed to speed up multiplication.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;multiply_mats&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; out&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; in_a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; in_b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      out&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; sum_arr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;v128_t&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_v128_load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum_arr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; k &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; k&lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;v128_t&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_v128_load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;in_a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;v128_t&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_v128_load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;in_b&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;v128_t&lt;/span&gt; prod &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_i32x4_mul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_i32x4_add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;v128_t&lt;/span&gt; sum_duo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_i32x4_add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_i32x4_shuffle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;v128_t&lt;/span&gt; sum_one &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_i32x4_add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum_duo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_i32x4_shuffle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum_duo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sum_duo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      out&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wasm_i32x4_extract_lane&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sum_one&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Version&lt;/th&gt;
&lt;th&gt;Time to Complete&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;JavaScript&lt;/td&gt;
&lt;td&gt;5.768s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;0.401s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebAssembly&lt;/td&gt;
&lt;td&gt;2.012s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebAssembly (w/ -msimd128)&lt;/td&gt;
&lt;td&gt;0.278s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WebAssembly w/ SIMD intrinsics (w/ -msimd128)&lt;/td&gt;
&lt;td&gt;0.245s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;As the result, we are &lt;strong&gt;95.8%&lt;/strong&gt; faster than the original JavaScript version!&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In this post, we visited a few methods to improve WebAssembly performance, and
finally we achieve a much better performance by using SIMD intrinsics. Although
it looks perfect, but there is actually a pretty steep learning curve to learn
SIMD intrinsics and master it. And you might only get less than 1% performance
improvement if your program is already auto-vectorized by the compiler. So the
best bet is to use &lt;code class=&quot;language-text&quot;&gt;-O3 -msimd128&lt;/code&gt; flags first and rewrite the most computing
intensive parts in your code using SIMD intrinsics to improve the performance
little by little.&lt;/p&gt;
&lt;p&gt;Hope you enjoy this post. :) Feel free to leave comments and try to run the code
using the source code in this repository: &lt;a href=&quot;https://github.com/jeromewu/wasm-perf&quot;&gt;https://github.com/jeromewu/wasm-perf&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Generics in Golang 1.18, no need to write max / min anymore (maybe)]]></title><description><![CDATA[One thing I do dislike in golang is that sometimes a simple task can be very tedious. One of them is getting maximum / minimum value of two…]]></description><link>https://jeromewu.github.io/generics-in-golang-1.18-no-need-to-write-max-min-anymore-maybe/</link><guid isPermaLink="false">https://jeromewu.github.io/generics-in-golang-1.18-no-need-to-write-max-min-anymore-maybe/</guid><pubDate>Tue, 08 Jun 2021 12:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a00fb1c04f9a6674b58e9fc9569a7065/29114/golang.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAC4jAAAuIwF4pT92AAAB5UlEQVQoz22RXWvTUBjH93W88FPo9RD0RhniBg7XpXWLV5vMixaUMXReOFCQsWJZ643I2EUJUlPXNtqXvJmXnjQJWZI2XZVkUtPZ5m20hWytey4O5znn/P7/53nOTPBf+L7v+b4XpkHg+YHnX0T4cmaauXQ3sG371HLPeqFKuE7DYcjtkzTJbpapBMHHaXH9B/2ihGf5hm3b3b+2M+hPwGMxptnaLpOvvxa2vhO7BBsvUw+Z4yX2OCkoqCi/wmpwFoUOkPc12nOcCWfXdaIHyPUn6ys5LIei3mDg9uznlZ/xXPEws+/5vnPWSxD1Gzu7c0hR6/wat3lR9k6+dPtTdrtC3b01C2Q5CIKkqMZzhdjCg77jBv1/L3F2vlp/g5Y8171U9mhIxkkHqnAxQkBI+tSyqrpx82ni2uwdBEiKaaUIZpmSHlEi1pCC4fz9CRioWpQSIdCCCAHGwQaa39uKvV279+4wNVeklxhltWHM18BnrjFsM4THMpyiQqS4ApqrdT0mdeAyhVfzPPZl8+jbY8GAgQYDfYEUMwy4wlnS9AghROr6MqtCnLrIamsF/BlytMhqEU6LcGqU1+7TcpLmh/DUV/3pdveVVrptpQ0zbZgZw0wZ5ofRZnzysW3uNX9jujG0G8Hnavoy0nFD7PIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;golang banner&quot;
        title=&quot;golang banner&quot;
        src=&quot;/static/a00fb1c04f9a6674b58e9fc9569a7065/f058b/golang.png&quot;
        srcset=&quot;/static/a00fb1c04f9a6674b58e9fc9569a7065/c26ae/golang.png 158w,
/static/a00fb1c04f9a6674b58e9fc9569a7065/6bdcf/golang.png 315w,
/static/a00fb1c04f9a6674b58e9fc9569a7065/f058b/golang.png 630w,
/static/a00fb1c04f9a6674b58e9fc9569a7065/40601/golang.png 945w,
/static/a00fb1c04f9a6674b58e9fc9569a7065/78612/golang.png 1260w,
/static/a00fb1c04f9a6674b58e9fc9569a7065/29114/golang.png 1920w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;One thing I do dislike in golang is that sometimes a simple task can be very tedious. One of them is getting maximum / minimum value of two integers.&lt;/p&gt;
&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;The root cause of the tediousness of this task is the lack of generics in golang which means you can not implement a max/min function which accepts both integer and float numbers. As the built-in max function is math package accepts float64, the common fixes that peope use are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Write a wrapper function for math.Max or math.Min to do type conversion&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;float64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;float64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Write your own max function&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; y &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; y
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; x
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You might think it is not too hard to implement any of the solutions above, but it is just a totally waste of time, especially when you are joining online contests or just practicing algorithms and data structure.&lt;/p&gt;
&lt;h2&gt;Generics to the Rescue&lt;/h2&gt;
&lt;p&gt;So with the &lt;a href=&quot;https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md&quot;&gt;new accepted proposal&lt;/a&gt; in golang 1.18, finally we can fix this issue once and for all (if the built-in math.Max &amp;#x26; math.Min is updated). A quick and dirty way can be done like below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; comparable &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;uint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;uint8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;uint16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;uint64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;uintptr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;float32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;float64&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; Max&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;T comparable&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; T &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;float64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;float64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;A working version &lt;a href=&quot;https://go2goplay.golang.org/p/_vWgGPiuyr_s&quot;&gt;HERE&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If similar code like above can be added to the built-in math library, we don’t need to do it ourselves anymore. I believe there are a lot more applications like this can make golang a more elegant and less-tedious language in the future. Looking forward to the release of this version next year. 😃&lt;/p&gt;</content:encoded></item><item><title><![CDATA[FFmpeg.wasm, a pure WebAssembly / JavaScript port of FFmpeg]]></title><description><![CDATA[Official Website: https://ffmpegwasm.github.io/ FFmpeg is a famous framework/tool when it comes to video/audio processing, now with ffmpeg…]]></description><link>https://jeromewu.github.io/ffmpeg-wasm-a-pure-webassembly-javascript-port-of-ffmpeg/</link><guid isPermaLink="false">https://jeromewu.github.io/ffmpeg-wasm-a-pure-webassembly-javascript-port-of-ffmpeg/</guid><pubDate>Wed, 04 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 256px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/107d248b86a21db313af2f7df1c1ded1/6f3f2/ffmpeg-wasm-logo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAJ17AACdewE8n3fEAAACnklEQVQ4y3VVv2sUURDeu03hz1IsUqmFhaUWSVqRoMjMBbTTBMNMLlxU7CKCGNNYCFFzGgP5A6JC8C+IYmFjbRNFOyshMxcRISaezHuzm3eXu+Lxdt/M+/abb35sRqgZgdiqEGrOIDmB5IwadreFZWeMkjNoX5+MoATMDJz9A8VOGGzVBHS/TyegVPzlNIEsMGqTQBcZ5SWBzBLIEbcbk3sM2mSUZwTSZNQXBPKIQI4XUWYJ5ccE0ibUtu3sO4EMu32NUPxsn89k8dGU4QkCuU0gHxnknwMvc01Nijf+sd8EepdA3hLIrgO+S6LIoiZRZDs4TyCb7rjiOq0yGpsAMEwog4TyzX3eT17WgTKprmEh+MUkjJUouL7iGOYOgY4QyClC2SqYjY9uVgg2B+qo2eyVP1mjtpV5KYRsLbnjasy8vuYQZgAbCmBQgq1P17bszgMC+UUgI06qamWRW2kw6hMX/D6jLrnYOyHMyKxVMJseM13lYRLRHTZ5QC0poVjNoenZEw/TnIe6wlx3sHm37/reCA2CATCWDaMuRmMJ1o/ZXCwf3SaQHxxJNLwB8lTDZb+404tZvWBmGY/aXiXQ5wbIqHXvoDzN8iiBfPZCtgSUzOpjLbPPmSQctR0nkEMEuuFaN8rCNuSpWivt0TMdmsVszlNkYmcTDHKQUb/4+3cCGSxbj+NwqPogOBc0i7qs1RPNwmXUcUY9QKhfg84gnxj0aNLrmV2ouKBnky7ZJtC1on89TIphyob7/CXQDwTylEBO9hkO2vY2a4dM7jX/Lfe50TEU9uwT6XAo1jECmWLUmwQyw6B1B7pgNTZ56af5HCaQ64xqQ6TBqDMEcs2Zl/Mw65rKcU+fUSs9ffoM2CyZFulYL56rXZdKn16/gP/hzih9BLDCJgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ffmpeg wasm logo&quot;
        title=&quot;ffmpeg wasm logo&quot;
        src=&quot;/static/107d248b86a21db313af2f7df1c1ded1/6f3f2/ffmpeg-wasm-logo.png&quot;
        srcset=&quot;/static/107d248b86a21db313af2f7df1c1ded1/c26ae/ffmpeg-wasm-logo.png 158w,
/static/107d248b86a21db313af2f7df1c1ded1/6f3f2/ffmpeg-wasm-logo.png 256w&quot;
        sizes=&quot;(max-width: 256px) 100vw, 256px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Official Website: &lt;a href=&quot;https://ffmpegwasm.github.io/&quot;&gt;https://ffmpegwasm.github.io/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;FFmpeg is a famous framework/tool when it comes to video/audio processing, now with ffmpeg.wasm you can use FFmpeg right inside your browser without installation or upload your file to the server. Although ffmpeg.wasm is not as fast as FFmpeg, but it might come in handy for certain use cases.&lt;/p&gt;
&lt;p&gt;In this post, I would like to share how to install and use ffmpeg.wasm and also technical details behind to support your usage.&lt;/p&gt;
&lt;h1&gt;Install ffmpeg.wasm&lt;/h1&gt;
&lt;p&gt;To install and use ffmpeg.wasm, you only need to use npm/yarn:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; @ffmpeg/ffmpeg
&lt;span class=&quot;token comment&quot;&gt;# or&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; @ffmpeg/ffmpeg&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To use ffmpeg.wasm in node environment, you also need to install &lt;code class=&quot;language-text&quot;&gt;@ffmpeg/core&lt;/code&gt; .&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; @ffmpeg/core
&lt;span class=&quot;token comment&quot;&gt;# or&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; @ffmpeg/core&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or you can use a CDN&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;script &lt;span class=&quot;token assign-left variable&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://unpkg.com/@ffmpeg/ffmpeg@0.9.3/dist/ffmpeg.min.js&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;/script&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Use ffmpeg.wasm&lt;/h1&gt;
&lt;p&gt;To use ffmpeg.wasm, only few lines of code are required:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createFFmpeg&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fetchFile &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;@ffmpeg/ffmpeg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ffmpeg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createFFmpeg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; ffmpeg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  ffmpeg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;writeFile&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;test.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetchFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./test.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; ffmpeg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;-i&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;test.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;test.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./test.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ffmpeg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;readFile&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;test.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Don’t forget to add &lt;code class=&quot;language-text&quot;&gt;--experimental-wasm-threads&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;--experimental-wasm-bulk-memory&lt;/code&gt; when executing the script in node.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Also you can try the live demo session in the official website: &lt;a href=&quot;https://ffmpegwasm.github.io/#demo&quot;&gt;https://ffmpegwasm.github.io/#demo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/815f07c1293ede899b156c597e324ed6/transcode.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;Behind the scene&lt;/h1&gt;
&lt;p&gt;To fully utilize/understand the power of ffmpeg.wasm (also for most WebAssembly libraries), few technical details you might want to know:&lt;/p&gt;
&lt;h2&gt;Inside ffmpeg.load()&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ffmpeg.load()&lt;/code&gt; is a required API to call before you call others. What happened inside this API is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Download ffmpeg-core.js from remote server (which is around 25MB)&lt;/li&gt;
&lt;li&gt;Instantiate ffmpeg.wasm wasm code&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Depending on your network speed and host machine hardware, this operation can take up to minutes to complete.&lt;/p&gt;
&lt;h2&gt;File System (FS)&lt;/h2&gt;
&lt;p&gt;When you check the API of ffmpeg.wasm, you may find an API called ffmpeg.FS() to handle File System operations. (In ffmpeg.wasm we use MEMFS / Memory File System) You can imagine this FS just like a hard disk where you can put the input file and pull the output file from ffmpeg.wasm command. It is essential as we want to keep minimal changes to FFmpeg source code and reserve its maxium similarity to original command line interface. Some command operations you might use:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ffmpeg.FS(&apos;writeFile&apos;, &apos;filename&apos;, data)&lt;/code&gt; : write file to MEMFS as input of ffmpeg.wasm&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ffmpeg.FS(&apos;readFile&apos;, &apos;filename&apos;)&lt;/code&gt; : read file from MEMFS as output of ffmpeg.wasm&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ffmpeg.FS(&apos;unlink&apos;, &apos;filename&apos;)&lt;/code&gt; : delete a file in MEMFS&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ffmpeg.FS(&apos;readdir&apos;, &apos;/&apos;)&lt;/code&gt; : list files inside specific path&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For full list of APIs, you can check: &lt;a href=&quot;https://emscripten.org/docs/api_reference/Filesystem-API.html&quot;&gt;https://emscripten.org/docs/api_reference/Filesystem-API.html&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;SharedArrayBuffer&lt;/h2&gt;
&lt;p&gt;SharedArrayBuffer is a pretty new data type in JavaScript, right now most of the browsers still lack of fully support due to security issues. But in ffmpeg.wasm, to enable pthread / mutli-threading support to speed up, it is a required data type to use. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SharedArrayBuffer introduction: &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Can I use SharedArrayBuffer?: &lt;a href=&quot;https://caniuse.com/sharedarraybuffer&quot;&gt;https://caniuse.com/sharedarraybuffer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Web Workers&lt;/h2&gt;
&lt;p&gt;When you run ffmpeg.run() , you might find tons of web workers spawned. It is a normal situation as web workers are simulating threads in FFmpeg and it is good as we don’t want ffmpeg.wasm to block our main thread.&lt;/p&gt;
&lt;h2&gt;Leverage CPU capabilities&lt;/h2&gt;
&lt;p&gt;For most of libraries work with ffmpeg (ex. x264), they use assembly language like x86 to speed up the process. But sadly, WebAssembly cannot directly use these x86 assembly code as it is not compatible or certain instructions are not supported. Thus it takes time to port x86 assembly to SIMD assembly to make it work.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;It is still a long way to go as ffmpeg.wasm is still in an early stage (right now it is only v0.9), although it is still very slow comparing to original version, but with the growth and evolution of WebAssembly, I believe it will become more and more useful. 😃&lt;/p&gt;
&lt;p&gt;Feel free to try and comments, issues or/and PRs are highly welcome!&lt;/p&gt;
&lt;p&gt;Github: &lt;a href=&quot;https://github.com/ffmpegwasm/ffmpeg.wasm&quot;&gt;https://github.com/ffmpegwasm/ffmpeg.wasm&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How to fix (80%) HiDPI issues in Gulliam OS 3.1]]></title><description><![CDATA[In 2019, I bought a Chromebook (HP Chromebook 13 G1, release on 2016) to be a lightweight laptop when I am out. I really enjoyed using…]]></description><link>https://jeromewu.github.io/how-to-fix-hidpi-issues-in-gulliam-os-3.1/</link><guid isPermaLink="false">https://jeromewu.github.io/how-to-fix-hidpi-issues-in-gulliam-os-3.1/</guid><pubDate>Sun, 12 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6470234371dd172b36b5f96220e654b0/71c8e/cover.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9ADNIVik3Pyk2PzE8RDZETmSMp32szXupyXyry32ry32rzH6szHyry4izz4q00XyrzLbP4efu9Nvk7t/p8AArP0s7VGQ+Ul9FWmhIVl9gc35/rMt8q8p+rMp+rMt/rMx/rcyArcx+rcuCrcyev9f4+/z2+fzg6fHh6vIAERcaHSoyMEBKLDhALD1JYXF6gaO3eq3OeKjJeKjJeKnKe6vLeqrLjrXRzNzo5+/1////9fn83ubv1uHrAB8rMxohJhQbHhskKRkhJhoiJzpFS1lxgoqvyY2zz42zz5G30oevzdDf7P////D2+uzy+Onv9drk7M7Z5AApO0oxRVMtPEYwQE0xRVItPEYhLzmnr7jv8fXw7/Dw7/Hy8fHf5Ov1+Pv2+/3w9Prj6/Pa4+zR2+XH094AHyw2L0RTNktaOUpVLkFOOFFhNUpZw8jM////9fb3+Pj5+Pj4+fr69vr97fP49fn82+Ptw9Ddws7avszYAAwPEBQbISQyPS49RR0lKRgkKyQ0P8PFyP////n6/Pr5+vj4+vH09+fu997o8Nbg6cjT37zJ1rnH1L3K1wAbJCsXHCAPExUSGRwhMDkaIygQFhpQWWBxe4NkbHJ6hIuRmJ7l5+r0+PzS3OfH09+7yda7yNXH0d3BzdkAITE9KTlEKjhAIi0zKDhDL0NRMD9LJTM+JztLLkFPPFFeTmFtwcfK+v//2uTuxNDcuMbTxtHcztfiws7ZAB8vOyo7RzFEUTBBTDRFTiw9TDRJWDZGUTJBTDdLWkBSXjJCTVxnb4eOlLrDzM7Z5cjT3svU38jS3b7L1gAZJSslND4tQE0vQUwsOD4aISYgLjcwQUwnMDYRGBwlMDgjLTMcJCg6Rk1daHDK1N7R2+TM1d/P2OK/y9d2Pm/oVuWc5wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Cover image&quot;
        title=&quot;Cover image&quot;
        src=&quot;/static/6470234371dd172b36b5f96220e654b0/f058b/cover.png&quot;
        srcset=&quot;/static/6470234371dd172b36b5f96220e654b0/c26ae/cover.png 158w,
/static/6470234371dd172b36b5f96220e654b0/6bdcf/cover.png 315w,
/static/6470234371dd172b36b5f96220e654b0/f058b/cover.png 630w,
/static/6470234371dd172b36b5f96220e654b0/71c8e/cover.png 875w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In 2019, I bought a Chromebook (HP Chromebook 13 G1, release on 2016) to be a lightweight laptop when I am out. I really enjoyed using Chrome OS with crouton, but one thing really bothers me is the fact I cannot run container. That’s why I decided to try the latest Gallium OS to get full Linux experience inside my Chromebook, but when I completed installing Gallium OS, the HiDPI hitted me and it took me tons of time to survey how to resolve this issue, but sadly I am only able to fix around 60% of them. To save time for people who may encounter the same issue, here is what did:&lt;/p&gt;
&lt;h2&gt;Update xfce configration&lt;/h2&gt;
&lt;p&gt;There was a package called &lt;code class=&quot;language-text&quot;&gt;galliumos-hidpi&lt;/code&gt; to fix hidpi issue, I check the scripts and this script is the derived version of it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Raise DPI from 96 to 276 to makes text size front&lt;/span&gt;
xfconf-query -c xsettings -p /Xft/DPI -s &lt;span class=&quot;token number&quot;&gt;276&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Enlarge cursor size&lt;/span&gt;
xfconf-query -c xsettings -p /Gtk/CursorThemeSize -s &lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Raise xfce panel height&lt;/span&gt;
xfconf-query -c xfce4-panel -p /panels/panel-1/size -s &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Enlarge notification area icon&lt;/span&gt;
xfconf-query -c xfce4-panel -p /plugins/plugin-6/size-max -s &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Enlarge window size&lt;/span&gt;
xfconf-query -c xfce4-desktop -p /last/window-height -s &lt;span class=&quot;token number&quot;&gt;1240&lt;/span&gt;
xfconf-query -c xfce4-desktop -p /last/window-width -s &lt;span class=&quot;token number&quot;&gt;909&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Enlarge desktop icon&lt;/span&gt;
xfconf-query -n -t uint -c xfce4-desktop -p /desktop-icons/icon-size -s &lt;span class=&quot;token number&quot;&gt;96&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Use xhdpi theme, you can alsto use &quot;Default-hdpi&quot;&lt;/span&gt;
xfconf-query -c xfwm4 -p /general/theme -s &lt;span class=&quot;token string&quot;&gt;&quot;Default-xhdpi&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Enlarge most of the icons&lt;/span&gt;
xfconf-query -c xsettings -p /Gtk/IconSizes -s gtk-menu&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48,48&lt;/span&gt;:gtk-button&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48,48&lt;/span&gt;:gtk-dialog&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48,48&lt;/span&gt;:gtk-dnd&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48,48&lt;/span&gt;:gtk-small-toolbar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48,48&lt;/span&gt;:gtk-large-toolbar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64,64&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To execute this shell script(say &lt;code class=&quot;language-text&quot;&gt;fix-hidpi.sh&lt;/code&gt;), you need to:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; fix-hidpi.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;GTK3 Scale&lt;/h2&gt;
&lt;p&gt;For small icons in menu, you can edit &lt;code class=&quot;language-text&quot;&gt;/etc/profile.d/gdkscale.sh&lt;/code&gt; and add following lines:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GDK_SCALE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.875&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GDK_DPI_SCAL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.38&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 1/2.875&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;xfce4-panel theming&lt;/h2&gt;
&lt;p&gt;For power manager plugin icon in xfce4-panel, create &lt;code class=&quot;language-text&quot;&gt;~/.config/gtk-3.0/gtk.css&lt;/code&gt; and add following lines:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#xfce4-power-manager-plugin * {&lt;/span&gt;
  -gtk-icon-transform: scale&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.38&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Work in Progress&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Lightdm&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Xscreensaver&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Extended Monitor (hard one)&lt;/p&gt;
&lt;p&gt;Hope it helps someone to save some time.(like 2 days. Lol)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[How to speed up Node.js modules installation in CI/CD pipeline as of 2020]]></title><description><![CDATA[When you use Node.js in your project, you need to take care of node_modules installation in your CI/CD pipeline. You may use , ,  and , but…]]></description><link>https://jeromewu.github.io/how-to-speed-up-node-js-modules-installation/</link><guid isPermaLink="false">https://jeromewu.github.io/how-to-speed-up-node-js-modules-installation/</guid><pubDate>Sat, 28 Mar 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b1f666a89ec88664eeec544daa426141/6af66/npm-vs-yarn.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoUlEQVQoz4WRzUsCQRjG/ZsMhOjQVQQj6NAlxIPgpYtHr36AhVArCltYLUZ4kMSDR/ugUgsiksiwSPKjdXXV3VU3XXdm3tANobJ8GGbgnef3fszoQBPGADDI53mXqxUI8B5P0+9vbm833O7m1tYo4vXKFxcTpyaddhCEAEBgGM7p7CSTZaNRjEQ4p7NqtXYSCTEa5RyOps83cU6D9/elWKxFUazdrhQKLYpqBYNSIsFvbLA2W5um/4O7yWRlZaVsNr/q9VI8XrVY3kymyupqyWQqGgxCODwd/kqBsVqtIlEUGYZbX5cYBmR5yLJqo4F4nigKfJcOpokAfKgq3+mwPA9/6xdMCEIICDmKHPo3N2maJhgDIV9rZmU8/oxMOp1KnRzH4/2BQkY5yYzKmuGhJkbvyw1ZmURmt43Hxrt3YT50agiklpmritDjJDnHtnOs0FNU7S2mwwiPrnZvinNUaungapE+37t5pTOFnezzbvblsSbAr+Z/Vi4J8lr0eiF04jt7ytfFy2IdABSEh3jmzOO93u3fVtqyomJC1DFD/hj9E7qqvOd3JV86AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;NPM VS YARN&quot;
        title=&quot;NPM VS YARN&quot;
        src=&quot;/static/b1f666a89ec88664eeec544daa426141/f058b/npm-vs-yarn.png&quot;
        srcset=&quot;/static/b1f666a89ec88664eeec544daa426141/c26ae/npm-vs-yarn.png 158w,
/static/b1f666a89ec88664eeec544daa426141/6bdcf/npm-vs-yarn.png 315w,
/static/b1f666a89ec88664eeec544daa426141/f058b/npm-vs-yarn.png 630w,
/static/b1f666a89ec88664eeec544daa426141/6af66/npm-vs-yarn.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;When you use Node.js in your project, you need to take care of node_modules installation in your CI/CD pipeline. You may use &lt;code class=&quot;language-text&quot;&gt;npm install&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;npm ci&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;yarn install&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;pnpm install&lt;/code&gt;, but what is the fastest way of doing so is still a question we are looking for answers. Here in this story I would like to experiment all possibilities I know to find out the final answer.&lt;/p&gt;
&lt;h2&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;If you are in a hurry, what you have to do are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Disable stdout output&lt;/li&gt;
&lt;li&gt;Use cached node_modules&lt;/li&gt;
&lt;li&gt;Use &lt;code class=&quot;language-text&quot;&gt;--prefer-offline&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Use global cache (&lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt; only)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; zxvf node_modules.tar.gz
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; --prefer-offline &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&gt;&lt;/span&gt; /dev/null&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you prefer yarn&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; zxvf node_modules.tar.gz
$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; zxvf cache.tar.gz
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; --prefer-offline --cache-folder ./cache &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&gt;&lt;/span&gt; /dev/null&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you prefer pnpm&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; zxvf cache.tar.gz
$ &lt;span class=&quot;token function&quot;&gt;pnpm&lt;/span&gt; config &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; store-dir &lt;span class=&quot;token environment constant&quot;&gt;$PWD&lt;/span&gt;/cache
$ &lt;span class=&quot;token function&quot;&gt;pnpm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&gt;&lt;/span&gt; /dev/null&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;The total speed up is around 3x comparing to pure &lt;code class=&quot;language-text&quot;&gt;npm install&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Existing Works&lt;/h2&gt;
&lt;p&gt;It is normal that someone already do it in the past, here are some existing works for your reference.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/appleboy/npm-vs-yarn&quot;&gt;https://github.com/appleboy/npm-vs-yarn&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://winsmarts.com/npm-install-speed-up-by-3-times-almost-25ad416cf77e&quot;&gt;https://winsmarts.com/npm-install-speed-up-by-3-times-almost-25ad416cf77e&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.tiernok.com/posts/2019/faster-npm-installs-during-ci/&quot;&gt;http://www.tiernok.com/posts/2019/faster-npm-installs-during-ci/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Environment&lt;/h2&gt;
&lt;h3&gt;Packages&lt;/h3&gt;
&lt;p&gt;To prevent any cache or unexpected behavior, I run the experiment inside a docker container and every time we complete an installation, we run a new container for the next installation.&lt;/p&gt;
&lt;p&gt;The docker image I use is &lt;code class=&quot;language-text&quot;&gt;node:12&lt;/code&gt; and the versions of each component are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;node: v12.16.1&lt;/li&gt;
&lt;li&gt;npm: 6.13.4&lt;/li&gt;
&lt;li&gt;yarn: 1.22.0&lt;/li&gt;
&lt;li&gt;pnpm: 4.12.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Network&lt;/h3&gt;
&lt;p&gt;I experiment both remote and local registry (verdaccio) scenario to show the influence of network. In local registry, I assumed the user do something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; react@latest --registry http://nvy-registry:4873
&lt;span class=&quot;token comment&quot;&gt;# or&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; react@latest --registry http://nvy-registry:4873&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which makes the registry url in lock files points to the local registry directly.&lt;/p&gt;
&lt;h3&gt;Application&lt;/h3&gt;
&lt;p&gt;To mimic a real world scenario, I did experiment in an web app that is created using &lt;code class=&quot;language-text&quot;&gt;create-react-app&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Commands&lt;/h3&gt;
&lt;p&gt;There are 5 basic commands I use:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;npm install&lt;/li&gt;
&lt;li&gt;npm ci&lt;/li&gt;
&lt;li&gt;yarn install&lt;/li&gt;
&lt;li&gt;yarn install —frozen-lockfile&lt;/li&gt;
&lt;li&gt;pnpm install&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;yarn install --frozen-lockfile&lt;/code&gt; is similar to &lt;code class=&quot;language-text&quot;&gt;npm ci&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;For all of them, I add &lt;code class=&quot;language-text&quot;&gt;&amp;amp;&gt; /dev/null&lt;/code&gt; to remove stdout output and the execution time is averaged from 3 times of execution. (As the execution time is pretty stable, I believe 3 times is good enough)&lt;/p&gt;
&lt;p&gt;Let’s start the experiment and see where we will achieve. 😃&lt;/p&gt;
&lt;h2&gt;Parameters&lt;/h2&gt;
&lt;p&gt;There are 4 parameters we are going to tune:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;local registry&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;With local registry, you can prevent stale when the network bandwidth is not enough. It is a good way to speed up but may be painful when someone clone your repository but unable to access the local registry you used. 2. cached node_modules&lt;/p&gt;
&lt;p&gt;A common technique to speed up the installation, by zipping &lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt; folder and unzipping before installation to eliminate the need of downloading modules again from network. 3. global cache&lt;/p&gt;
&lt;p&gt;There is a global cache folder in &lt;code class=&quot;language-text&quot;&gt;~/.npm&lt;/code&gt; for npm and &lt;code class=&quot;language-text&quot;&gt;~/.yarn&lt;/code&gt; for yarn, by adding global cache in advance, I would like to know if it is possible to speed up. 4. &lt;code class=&quot;language-text&quot;&gt;--prefer-offline&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Details: &lt;a href=&quot;https://docs.npmjs.com/misc/config#prefer-offline&quot;&gt;https://docs.npmjs.com/misc/config#prefer-offline&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If true, staleness checks for cached data will be bypassed, but missing data will be requested from the server. To force full offline mode, use &lt;code class=&quot;language-text&quot;&gt;--offline&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;With this option, we can prevent npm or yarn to check remote data and use local cache directly.&lt;/p&gt;
&lt;h2&gt;Experiment&lt;/h2&gt;
&lt;p&gt;Below are the result of all configurations:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4a3672cf81785fc1781387354b2ce1a/5a6dd/statistics.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 143.67088607594937%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAIAAAAl5NuSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEAElEQVQ4y32VS28bVRTH8zFgwQZVQixQNghFSCxQFwhUAeITwAIkFixYsigpIqICBGpBggZoKGqbNE1q5x1EnJBAW4d4/Mj4ETtO/B6/Zjxvj+fO3HMP8iOOCW6uRqN7Z87v/P9z77l3RhhjhBDXdQkhjuPYtk06PUIIpRTPbSMAoGmaaZqK2rnLsqHruq5qmtqybTYYywDZfx6M9HuyQTVdJ7JoyTK1RVMVNdOo65KuarquqZrmqlVdlQ3DHAIjImXtq62BCKwtA5QBdRl1ESgCBYBTH4z14KbZrNXriUhs+ee59d8W1m55/3h84IuWN1O01jrNDgO2T+FSsbDHRbntOxvfPOW7fsF37dmtu2N/eS7q4ZuY2mIHG5j0YXKDGSL2nJ3AjDHLskzT1FRVFRumohmyqpUELV8wcwko8UzgsRzFMg+WNkTZdd1qrbYf4DzfTy5NTi3euLn2iFuP5fYEcLpCXduDc9+Hi4V8IBTbfzTj/+EZ/0/P+yef251+MeR9FSKTGPMiP48RD4ZmoRgeqkxdh+iGXZNAVrGhoFh1RKFZzZUq2ZxSyqFcwEYezMZZ2HXder1ertb4wO79L8c917548NUV7+yt1Uj47yzdyeJBo+d8iG3bttPpVJhPJgKe0O0XwjNj4emXQrNjseXXIf4rHs4jfx/D8xiYgXp6iO1u4qbFchUUJCyJWKxgsczSWTWdkZqKjJaCTRmc1lnYcRxJErP5Yuihb+6zd71XP/RMvL84/+3vgbVgzo4KaDpPLhJCSDabiR8cp/n12MLF+Mqb8eVLsaU3UqvvQPgX5O9hcBq5GeTusb07qBR7KMCJ7U5GRaPxDKaLeJjHVAHTAhoGAWKBY6HbQrcFpNneW31l1uFM04glUv9sehc+fW1x4u2lK5fWbn+8FbqrW2Y37rzabjSkZCqbSW6nd9472vkgxV2OVleS1Q2XNpENwEN3VXcoSiQSRf4AqwWKBNhJ0Hlwq9WqVMrRxCH35/zi5dHlz18pzE46RylA6KHnwK7rSpJYKFZLOe5o75NccNzREoAI1Gad04AB7ZxBAECHFUkndUOyucdOJED1rIk27dfP6a5i/ytPy7LyuWwwEt/bnFkZv7A6Mfrw69Gg5619/0dG2Y9ajakCahVUy9BUzsKMMdM0RFGpVZKZ+I+F1NRxfCoVunHov94Mz2JslcWWMbaK/AII/JNsQ6Wo7K5XAr6aEhXwMIOy2pvt820LQikYjnPb06tXn97+7mV1Z87e55zicTsGgLUnuf3tw9fZdRxZ0aXqcY6frsUfUDHZ9zO4VGxohfXNd98yANJqdQeu6/b/O4SQ3glPqeM4I4OZoN0odFa17xAA+oL9LN3gfwHeejrG8SvrSQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Statistics&quot;
        title=&quot;Statistics&quot;
        src=&quot;/static/f4a3672cf81785fc1781387354b2ce1a/f058b/statistics.png&quot;
        srcset=&quot;/static/f4a3672cf81785fc1781387354b2ce1a/c26ae/statistics.png 158w,
/static/f4a3672cf81785fc1781387354b2ce1a/6bdcf/statistics.png 315w,
/static/f4a3672cf81785fc1781387354b2ce1a/f058b/statistics.png 630w,
/static/f4a3672cf81785fc1781387354b2ce1a/5a6dd/statistics.png 802w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The number is the amount of seconds to complete modules installation&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Observations&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Always remember to disable the output of installation with &lt;code class=&quot;language-text&quot;&gt;&amp;amp;&gt; /dev/null&lt;/code&gt; as stdout is pretty time-consuming&lt;/li&gt;
&lt;li&gt;Although local registry can guarantee the stability of downloading modules, it is not recommended to modify lock file to gain this benefit as the side effect is huge.&lt;/li&gt;
&lt;li&gt;The speed of &lt;code class=&quot;language-text&quot;&gt;npm ci&lt;/code&gt; is stable across different configurations, but &lt;code class=&quot;language-text&quot;&gt;npm install&lt;/code&gt; can be faster with &lt;code class=&quot;language-text&quot;&gt;--prefer-offline&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The speed of &lt;code class=&quot;language-text&quot;&gt;yarn install&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;yarn install --frozen-lockfile&lt;/code&gt; are NOT different at all.
Global cache is more useful for &lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The efficient of &lt;code class=&quot;language-text&quot;&gt;pnpm&lt;/code&gt; highly relies on the global cache, without cache, its speed is slower than others due to cache pre-processing overhead&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;For the source code of this experiment can be found in this repository: &lt;a href=&quot;https://github.com/jeromewu/npm-vs-yarn-in-cicd&quot;&gt;https://github.com/jeromewu/npm-vs-yarn-in-cicd&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Hope you find it helpful and if you have any ideas to experiment to speed up even further, please feel free to leave a response or create an issue inside the repository. 😄&lt;/p&gt;</content:encoded></item><item><title><![CDATA[I wrote a Chrome Extension (Gitpod Window). Here is what I learned]]></title><description><![CDATA[Gitpod is an online IDE for GitHub and GitLab, it is great and makes my life easier when there is not enough resource in my laptop. But as a…]]></description><link>https://jeromewu.github.io/i-wrote-a-chrome-extension-here-is-what-i-learned/</link><guid isPermaLink="false">https://jeromewu.github.io/i-wrote-a-chrome-extension-here-is-what-i-learned/</guid><pubDate>Mon, 23 Mar 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7cf3bd708f5bff7ee16e15b8b544354e/01e7c/banner.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSklEQVQ4y9WUQUhTcRzHP///m0PGzLaWJAo1idnRQqFR2qmBiRYhRShJQYek6OChoBVlqFuZur0IDDqEF+vQrRC05oykUreFl6KColOHEi8d2tv+MTdksrlmnfrDh+978Huf9/2/Pzz4L1Z1dTW1tbWr95qm/ZvQ5/NhGEbq0tTQ0FDidDpLgBIhxEr+gZy3y0zWSSm/AB9TSCk/AYVIzX0GFoDKjENkC/eVlZWpjo4OZTabFVAsPwFnjtBkMrlTA7qux1taWgy73Z5wOBwJYD3iGeF3YHu+hm6bzaaampoSLpcr6fV6lcfjKdQskcmlHKEQAiGEO2swWcRWEwipEHIJREYo1jZMDQohVoRCiPVlUstu+AOT2Zl3yxtpKDdtSVjbzqlSd9ty6pTtnVextnbLvxAKZWlsV+Wn+pOWg13K2t7zq3J0UXdNJnfUzCmKF0qZblbfrCwne5W1+UyyYmhGOS6OLW++FX5guf9hlv5QeT5hPIOxBinTWX/IYO+RZKk/ZFQ8/GbYxr4qqcfGGZ5/LPRYVbZwf8HvJtIN2eNRNB5LcOmRYui1omtAcfzKUUbfX+b2q52rJwPsAkLAVF6k9gyY4MCJCK3nFYcvvGD4zTuuPZnGN91DMDbOyPzWjf1FrLZ0Ds6e5vrTe/jCZ7mz6CUQCRKI7CYYzXlEFKSmTqAUDL6EmzNV+Gd6CUQ6GZ5jRRaMiuLb2bals/su3JjQGAiBPwzBGOhvIRCV+Rquv/qmoG8SBp6ns29S4A9rBKOSkYWUEAIRfgNUvxjeWt6o+gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;banner&quot;
        title=&quot;banner&quot;
        src=&quot;/static/7cf3bd708f5bff7ee16e15b8b544354e/01e7c/banner.png&quot;
        srcset=&quot;/static/7cf3bd708f5bff7ee16e15b8b544354e/c26ae/banner.png 158w,
/static/7cf3bd708f5bff7ee16e15b8b544354e/6bdcf/banner.png 315w,
/static/7cf3bd708f5bff7ee16e15b8b544354e/01e7c/banner.png 512w&quot;
        sizes=&quot;(max-width: 512px) 100vw, 512px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Gitpod is an online IDE for GitHub and GitLab, it is great and makes my life easier when there is not enough resource in my laptop. But as a VIM user it is pretty annoying when I hit Ctrl+w (which is commonly used to navigate between different VIM window), the whole Gitpod tab just close and I have to reopen it again.&lt;/p&gt;
&lt;p&gt;That’s why I start to work on a Chrome Extension (Gitpod Window) to make the overall experience of using Gitpod even better. The requirements I listed are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;When user click the extension icon on a GitHub or GitLab page, opens Gitpod workspace in a popup Chrome window&lt;/li&gt;
&lt;li&gt;Disable Chrome shortcuts&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;As I have almost no experience in building a Chrome Extension, I wrote this story to record the process and hope it can help newbies like me. 😃&lt;/p&gt;
&lt;h2&gt;Get Started with Chrome Extension&lt;/h2&gt;
&lt;p&gt;Google provides a good official tutorial here: &lt;a href=&quot;https://developer.chrome.com/extensions/getstarted&quot;&gt;https://developer.chrome.com/extensions/getstarted&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Quick summary for key components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;manifest.json: Provides important information&lt;/li&gt;
&lt;li&gt;Background Script: Extensions monitor events in their background script, then react with specified instructions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here we learnt that background script is where we can monitor events and it is a good starting point to achieve our goal.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I would suggest those who want to follow the next step to complete the tutorial in the link above first.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;When user click the extension icon on a GitHub or GitLab page, opens Gitpod workspace in a popup Chrome window&lt;/h2&gt;
&lt;p&gt;As you can imagine, click on extension icon is an event, so we can do it in background script.&lt;/p&gt;
&lt;p&gt;To handle the event, there are two types of actions you can choose: &lt;a href=&quot;https://developer.chrome.com/extensions/pageAction&quot;&gt;pageAction&lt;/a&gt; and &lt;a href=&quot;https://developer.chrome.com/extensions/browserAction&quot;&gt;browserAction&lt;/a&gt;, as our extension only works on specific websites, we use &lt;code class=&quot;language-text&quot;&gt;pageAction&lt;/code&gt; here. A primary &lt;code class=&quot;language-text&quot;&gt;manifest.json&lt;/code&gt; below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;manifest_version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Gitpod Window&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Gitpod Window disables browser shortcuts for you to prevent unwant behavior&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Jerome Wu &amp;lt;jeromewus@gmail.com&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;permissions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;*://github.com/*/*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;*://gitlab.com/*/*&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;background&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;background.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;persistent&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;page_action&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In &lt;code class=&quot;language-text&quot;&gt;permissions&lt;/code&gt;, we add GitHub and GitLab URLs to restrict that this extension only works on the repository page. (ex. &lt;a href=&quot;https://github.com/jeromewu/gitpod-window&quot;&gt;https://github.com/jeromewu/gitpod-window&lt;/a&gt;) We also add a key page_action to identify that we are going to use &lt;code class=&quot;language-text&quot;&gt;pageAction&lt;/code&gt; APIs in this extension.&lt;/p&gt;
&lt;p&gt;With &lt;code class=&quot;language-text&quot;&gt;manifest.json&lt;/code&gt; settled, next we need to update &lt;code class=&quot;language-text&quot;&gt;background.js&lt;/code&gt; to popup the window with &lt;a href=&quot;https://developer.chrome.com/extensions/windows&quot;&gt;windows&lt;/a&gt; API:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/*
 * Window popup using page action
 *
 * @ref: https://developer.chrome.com/extensions/pageAction
 *
 */&lt;/span&gt;

chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pageAction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onClicked&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; url &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;windows&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;https://.gitpod.io/#&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;url&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;popup&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ideally, we should be able to see a new popup window created when we click on the extension icon, but if you try to code above, you will see a context menu instead.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cc3e2de3e8fe395c8958996db64b9fbf/3996e/popup.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 110.12658227848102%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsUlEQVQ4y42UXWvTYBTH+zFEEWHgjYI37sXWtrOs6+beN8cUi7tRdqlMQRC8EC/Ue9ELP8Xs6prWueEHmBfDNoHEvndJk7ZPkid58jSvktburWvnj/BweDj/nJPD/8QzPOK7OTgyM7uwvv48Mj27Foy8CM8M+wJz80sfP32ORle9Xn8wGAoERkOhsN8/6vMFxsIT45G7gWDIMzE5deHi5fD45Id374cDo2+GQl/GFi5dGZiantve2X38ZM3r9U9OTC0tLs/NLwaDdwYGrg4OeUdu3b52/YZnLBxJJAiCSO3u/tz+sbOVTH0jkqnv20Qytbf3iyCIjY2vsVg8Ho/HYrHNzc1Egkgkklut0/Pq9VvHcWzbNgxT03BTNzXcxLiJdQPjptMXz7OnLx3HMU1TURRBEOp1AESx0QB14Aa6bpzC7KDrumdl5YHjOIZh2LZ9xstbd7ZL+3Rpiw3D8ESjq+00hDRRlFRVlSEUJVlVEYSKDBVZhqqqSpKEEHITkNrOtyzL8/BIjHihBiEUhBpX5SVJAgDwvFAsVxqtAACR46q1euMMsWVZpmlalnV2/12cEAMACoViqVzhqrztHH3hEZ3L0+L/rNazcqVSSacz2VyuUCwyzJ9sNpfN5RmaoRkmXyjY/cWGYSCkIYQ0TdObOsa4qetY0zDGCCHLsvqJZUliWVZ0kTiOqzcatXpdBEAQalBRzh8YQ9Msy1V53p1cqVQslg4ODnK5PFfle4kf9XOY889hZheuww4rQwgBABC6flJUVRRFGcqS5Hru/GmzLLu//5siyQxF5fP5dIakaYYiqXK50q7es22zY6zjNjhcDcu2ux/TNDvi1orpxzZQP7mA3bgredg2xpgXajwvyBDW6o1qVUAInfMzuLd8n6ZpkiQpisq0IEky7eLGVG9IkvwLlMR1TEOoSf4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;popup&quot;
        title=&quot;popup&quot;
        src=&quot;/static/cc3e2de3e8fe395c8958996db64b9fbf/f058b/popup.png&quot;
        srcset=&quot;/static/cc3e2de3e8fe395c8958996db64b9fbf/c26ae/popup.png 158w,
/static/cc3e2de3e8fe395c8958996db64b9fbf/6bdcf/popup.png 315w,
/static/cc3e2de3e8fe395c8958996db64b9fbf/f058b/popup.png 630w,
/static/cc3e2de3e8fe395c8958996db64b9fbf/3996e/popup.png 648w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The behavior is not the same as we expected and if you take a close look to the chrome.pageAction.onClicked.addListener(), you will see an interesting statement:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7c4a76b05021e3d6636ea100403502ca/64a58/onclicked.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.088607594936708%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAW0lEQVQI13XMQQrAIAxE0d7/lhXEhVAXqcloDCktiBTat/qbmQ1AjJGIzEbvXVX7slpVzczfNncv5cg5E50QASDTXUCtFQAzt9Y+ximlsAciEpE6MQMynhP2Hxd5C68HEV+0gQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;onclicked&quot;
        title=&quot;onclicked&quot;
        src=&quot;/static/7c4a76b05021e3d6636ea100403502ca/f058b/onclicked.png&quot;
        srcset=&quot;/static/7c4a76b05021e3d6636ea100403502ca/c26ae/onclicked.png 158w,
/static/7c4a76b05021e3d6636ea100403502ca/6bdcf/onclicked.png 315w,
/static/7c4a76b05021e3d6636ea100403502ca/f058b/onclicked.png 630w,
/static/7c4a76b05021e3d6636ea100403502ca/40601/onclicked.png 945w,
/static/7c4a76b05021e3d6636ea100403502ca/78612/onclicked.png 1260w,
/static/7c4a76b05021e3d6636ea100403502ca/64a58/onclicked.png 1577w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;This event will not fire if the page action has a popup.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As we don’t do anything about popup, it means the popup doesn’t exist, right? The answer is yes, but there is a strange behavior for onClicked, usually it should look like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8b033e747b945186f2d61c15ff2e43fc/3c5de/flow1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQoz5WQ4Y7CIBCE+/7PZ2LU1qgRWcpCYVtYSmy5XJs0XqKXu+/fDjO7E6rz+dz3vfceEQGglDLPcyllmiattZQyhLCJWuuu65xzwzDUdV0ppUIIWuuU0uPxyAtEJIQwxvR9DwDe+xgjMzdN45yLMaaUjsdjdbvdTqfTfr+31gLAOI45Z+fc/X7vFpRSxhheaJpGCGGtJaLdbldJKddWOWel1NZwHMe2bRHRe/9ae1oopQghvmu3C0opZi4Lq5WItNbruCrMDABrBACq8hlmJqJfDNX8wqY+n09EvF6vdV23bTsMw/b06n9/OYSAiG//4sflT4WllM45Y4y1dlv0p3CMERFTSiEEIvpfmJkPh4NYuFwuQoi34S+aFHr2DXFVzwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;flow1&quot;
        title=&quot;flow1&quot;
        src=&quot;/static/8b033e747b945186f2d61c15ff2e43fc/3c5de/flow1.png&quot;
        srcset=&quot;/static/8b033e747b945186f2d61c15ff2e43fc/c26ae/flow1.png 158w,
/static/8b033e747b945186f2d61c15ff2e43fc/6bdcf/flow1.png 315w,
/static/8b033e747b945186f2d61c15ff2e43fc/3c5de/flow1.png 472w&quot;
        sizes=&quot;(max-width: 472px) 100vw, 472px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;But actually, the decision is made after chrome.pageAction.show()&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1f02d2f95ad2a2cdcfef1043421bea59/dba9a/flow2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.87341772151899%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4UlEQVQY05WOSW6EMBBFuf/Z2PQBWCCEwUO5qjyAwWC3gqUsEimtvFWpvv7QTdNERMuyxBhTSvM8M7MxhoiUUimlUopSChFLKbVW55yUMsb4er06IcQ4jsYYZgYAKSUiDsMQQoCHdV2JyDyklJZlEUJc19X3fdfimdl7H2NUSm3b5r3ftg0AQgj7vkspAeA4jlKKtVZrfd/3VzMROeeY+bqu+75bive+HW1qCCGlVB9yzs457z0idvUTrY2Zf0vd37Zaq5SyTQOA7+dnc0NrjYhEZK39R3PDWptzPs8TEX+Y3yPuzdFHUBuXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;flow2&quot;
        title=&quot;flow2&quot;
        src=&quot;/static/1f02d2f95ad2a2cdcfef1043421bea59/f058b/flow2.png&quot;
        srcset=&quot;/static/1f02d2f95ad2a2cdcfef1043421bea59/c26ae/flow2.png 158w,
/static/1f02d2f95ad2a2cdcfef1043421bea59/6bdcf/flow2.png 315w,
/static/1f02d2f95ad2a2cdcfef1043421bea59/f058b/flow2.png 630w,
/static/1f02d2f95ad2a2cdcfef1043421bea59/dba9a/flow2.png 652w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So if you don’t trigger chrome.pageAction.show() first, it won’t trigger onClicked, I found this answer when checking samples from &lt;a href=&quot;https://developer.chrome.com/extensions/examples/api/pageAction/set_icon.zip&quot;&gt;HERE&lt;/a&gt; and it is really a trap when using onClicked.&lt;/p&gt;
&lt;p&gt;To solve this issue, we need to trigger chrome.pageAction.show() on the tab we click extension icon manually. We need to use onUpdated and onActivated in &lt;a href=&quot;https://developer.chrome.com/extensions/tabs&quot;&gt;tabs&lt;/a&gt; API. Before we start using tabs, don’t forget to update &lt;code class=&quot;language-text&quot;&gt;permissions&lt;/code&gt; in the &lt;code class=&quot;language-text&quot;&gt;manifest.json&lt;/code&gt; first:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;manifest_version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Gitpod Window&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Gitpod Window disables browser shortcuts for you to prevent unwant behavior&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Jerome Wu &amp;lt;jeromewus@gmail.com&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;permissions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;tabs&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;*://github.com/*/*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;*://gitlab.com/*/*&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;background&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;background.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;persistent&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;page_action&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then let’s update &lt;code class=&quot;language-text&quot;&gt;background.js&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/*
 * Window popup using page action
 *
 * @ref: https://developer.chrome.com/extensions/pageAction
 * @ref: https://developer.chrome.com/extensions/examples/api/pageAction/set_icon.zip
 * This is a workaround to make sure chrome.pageAction.onClicked works.
 *
 * The idea here to to force popup to show on GitHub and GitLab pages,
 * but as we don&apos;t assign popup, it fails and called onClicked.
 * If we don&apos;t do this, onClicked won&apos;t be triggered.
 */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;forcePopup&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token regex-source language-regex&quot;&gt;https?:\/\/(github|gitlab).com\/*\/*&lt;/span&gt;&lt;span class=&quot;token regex-delimiter&quot;&gt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pageAction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tabs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onUpdated&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;tabId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; activeInfo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tab&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;forcePopup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tab&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tabs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onActivated&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; tabId &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tabs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tabId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; forcePopup&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pageAction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onClicked&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; url &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;windows&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;https://.gitpod.io/#&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;url&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;popup&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The idea here is to call chrome.pageAction.show() on the GitHub and GitLab pages to trigger onClicked.&lt;/p&gt;
&lt;p&gt;Now we have completed our first requirement! It is a nice-looking popup window that makes Gitpod more close to an IDE, but there is no IDE can be closed with Ctrl+W, let move on to the next part to disable shortcuts.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6f238c554f4c6634501a0fda09998333/64a58/gitpod.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.9493670886076%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACK0lEQVQoz22Rf0/UMBzG9z5O7kd3a/tt19/txgYXGVNCDg0J/mM04RASTXwpvhRjMMfdBCJG//CFmW2IBPnkyZJ2ffo8baNPF78/r66+LNfn68vz9eX6+uby5tfVj043P5vr76tvV6umuVh3appV0yzX66/Li+Wqiaq3763z3lrvXVkU3rvMW6eVSLmSQqScAWUAjHWCW2ltZluz6OD1cRlsWRTGGKbMbKfS+2/o/BSJgMajeNoST6fxPRBCSqu6rqPt+VERTLXzNIQAjJXllsxneqsWxsUIxY8xmUy01lVVRdvVM+9dURRaa855WZbemjw47x3pwBgTQqb3aJOVyvM82ql2fQiUUgDAGLenY6z/cs7TNO2G8KA2ALTml4dH3jtKKWPsQT30l//nMcZZlkUuBGstdFn3V/QNHz0zQogQ0pqN91qpO3OfgxCadDwa/i9ZW6e17s0UKKWUEKK1sdZZa/tfAPDgzjjnrdn6oPVtsi2FdIpJr2xmQ6HdplRGSmmMUVKmQnDOhRBpmkopO/Nm3tcGgOBDlmXtUqWMMVor22GM6VuEEJxzxmgh0tascq+1ge5lhBSMc0woJpRQ6IUJSXDLNEnaFyc0SRIAyLI8splVHGgSA54yOSKACGFAASh0GyQYDdFwEI+exKMnaDiYbAzGG4NkMs6didIXC334IT044wdnyfMF2VuI+Qmqj4e7x+N6Ma5P7jSqF/HeCey/o/snfH7qX338Aw6GvyUaXbENAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitpod&quot;
        title=&quot;gitpod&quot;
        src=&quot;/static/6f238c554f4c6634501a0fda09998333/f058b/gitpod.png&quot;
        srcset=&quot;/static/6f238c554f4c6634501a0fda09998333/c26ae/gitpod.png 158w,
/static/6f238c554f4c6634501a0fda09998333/6bdcf/gitpod.png 315w,
/static/6f238c554f4c6634501a0fda09998333/f058b/gitpod.png 630w,
/static/6f238c554f4c6634501a0fda09998333/40601/gitpod.png 945w,
/static/6f238c554f4c6634501a0fda09998333/78612/gitpod.png 1260w,
/static/6f238c554f4c6634501a0fda09998333/64a58/gitpod.png 1577w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Disable keyboard shortcuts&lt;/h2&gt;
&lt;p&gt;To disable shortcuts, I planned to use &lt;a href=&quot;https://developer.chrome.com/extensions/commands&quot;&gt;commands&lt;/a&gt; API, but in the end I found that you don’t need to do anything as the shortcuts that annoying us are disabled by default. (incl. Ctrl+W, Ctrl+N, Ctrl+T) So we complete this issue by using popup window here!&lt;/p&gt;
&lt;p&gt;Hope you enjoy this story and if you would like to know more about this Chrome Extension, you can visit:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GitHub Repository: &lt;a href=&quot;https://github.com/jeromewu/gitpod-window/tree/v1.0.1&quot;&gt;https://github.com/jeromewu/gitpod-window/tree/v1.0.1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Chrome Web Store: &lt;a href=&quot;https://chrome.google.com/webstore/detail/gitpod-window/jhpkbhdoenpnfnnkelgpikndadikogdl&quot;&gt;https://chrome.google.com/webstore/detail/gitpod-window/jhpkbhdoenpnfnnkelgpikndadikogdl&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[3 Things you should do to quickly fix your problem in a open source project]]></title><description><![CDATA[As a developer, it is common to leverage open source projects to complete your application, and it is more common to find your requirement…]]></description><link>https://jeromewu.github.io/3-things-you-should-do-to-quickly-fix-your-problem-in-an-open-source-project/</link><guid isPermaLink="false">https://jeromewu.github.io/3-things-you-should-do-to-quickly-fix-your-problem-in-an-open-source-project/</guid><pubDate>Wed, 15 Jan 2020 12:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/caf3d38ad9999fc0cf767a457c2d2db7/6af66/banner.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8klEQVQoz41Sz0sbQRSeP0G8BW0RD/bQYqSoJUVFUHsIxMMi3jxISi8epOCPnipUsY1aqKIHQamtl2pJQRBcbXERDFEMJqQp3ZbGZS24datx28Yk7s68V9wxiRVL+3iHeT++9818bwjaxgCp7QzwUgPbLiQJRyKC7Ze0McYsy+JZfsiD7QCOLYgdQFgH7fgM/zfC8xmCCKF97Av86tswn26jb+tk+asFmB+RSqUeDw42NTTcaWwcGx01TTPPrP6gPYvR/smRcXFzIpZ+trA8MD0Z1ZMcjYje9va6mprqyspbVVW3Xa77nZ05fhJ6v/Z6ffbVI/fzbs+qujL3RJjtb91QJWqdMohLS1eLi3Vd51TxeLzI4QgGg1wLsrrt90sPv226d8Mt+k7bXqxVDQma3HGSOUTEkeGhutpa3sovUuF0Tk9NISKllHREM4K0hp+uK/M33nZdU+bK8WMZlZuodSrdG7+/tKQkEAhQSgFRFMXCggJJks7A3Z+x/t0H2HLszFxRXpYqL4pYuBD2J7igyWTyrtfb7PEYhhGJRAghLYKQk52YiOmfCsbu4RcXqjdx1w3fZxBoTjBN04Z8PsMwZFl+0Nt7lEjkSiS7PoRMgqX3gGbskP3XnoGPyXbbdZr9bXheKv5Oxtgf3zNLzS7A/mm/Ab+VnX2UHLVZAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;banner&quot;
        title=&quot;banner&quot;
        src=&quot;/static/caf3d38ad9999fc0cf767a457c2d2db7/f058b/banner.png&quot;
        srcset=&quot;/static/caf3d38ad9999fc0cf767a457c2d2db7/c26ae/banner.png 158w,
/static/caf3d38ad9999fc0cf767a457c2d2db7/6bdcf/banner.png 315w,
/static/caf3d38ad9999fc0cf767a457c2d2db7/f058b/banner.png 630w,
/static/caf3d38ad9999fc0cf767a457c2d2db7/6af66/banner.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;As a developer, it is common to leverage open source projects to complete your application, and it is more common to find your requirement unsatisfied or a bug stopping from fulfilling your goal.&lt;/p&gt;
&lt;p&gt;Here are 3 tips for you to quickly fix problems in open source, it might be intuitive, but useful if you haven’t tried before.&lt;/p&gt;
&lt;h2&gt;Check Documents&lt;/h2&gt;
&lt;p&gt;Many open source projects comes with Wiki, an official website or a &lt;code class=&quot;language-text&quot;&gt;doc/&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;docs/&lt;/code&gt; folder inside the repository. These locations are the first place you should look for clues to fix the problem you faced, most open source maintainers tried to keep these documents update-to-date to make sure newcomers can find what they need without too much trouble.&lt;/p&gt;
&lt;h2&gt;Search Issues&lt;/h2&gt;
&lt;p&gt;Most of the time, you may not be the first one to face the issue if the use case you have is common, so don’t forget to search the issues inside Github or similar platform. And not just search open issues (default option in Github), but remember to check closed issues. It is a quick way to find some hotfix or even work around when your issues is not fixed by the maintainer so far.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/13efa231224e0b8cd736e0055c7a88a6/64a58/issues.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 18.354430379746837%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArUlEQVQI1z3MTWrDYAyEYd//CoWeoosepJvSRReBUhL/yPpGGkmfY4cmoTA8zOodYK7nHxt/g1wVDWbOh7I2RirMGDCaE+Zw9u26bdfjOAZtxixjegQjGRlZkZlVjKfVuzsZ4eTa9Oj7Zzu9nt6HyyTabBEVRVbP6pEPi1HM8r9c1wbAYZxlJeJj+n75ehvGWc7jImqzqDH/p/B5bQoXhagt93+ZBB7Too7Yud8AOePkWRu07PEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;issues&quot;
        title=&quot;issues&quot;
        src=&quot;/static/13efa231224e0b8cd736e0055c7a88a6/f058b/issues.png&quot;
        srcset=&quot;/static/13efa231224e0b8cd736e0055c7a88a6/c26ae/issues.png 158w,
/static/13efa231224e0b8cd736e0055c7a88a6/6bdcf/issues.png 315w,
/static/13efa231224e0b8cd736e0055c7a88a6/f058b/issues.png 630w,
/static/13efa231224e0b8cd736e0055c7a88a6/40601/issues.png 945w,
/static/13efa231224e0b8cd736e0055c7a88a6/78612/issues.png 1260w,
/static/13efa231224e0b8cd736e0055c7a88a6/64a58/issues.png 1577w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Open New Issues&lt;/h2&gt;
&lt;p&gt;Open new issues is the last thing you can do, but most of us may have experience that there is no response for days and feel like our issues are ignored by maintainers. It is kind of normal, but a little change can make the story different.&lt;/p&gt;
&lt;p&gt;You have to know that maintainers are human like you and me, so they are unable to fix your issues if the information is not sufficient. I have been maintainers for open source projects for few years and there are more than 50% of the issues are poorly described and thus I was unable to fix without asking few more questions and it really takes lots of time for both sides to wait for replies from each other.&lt;/p&gt;
&lt;p&gt;To quickly fix the problem, you have to open a good quality issue to enable the maintainers to understand your situation without too much effort. A good issues should include information like:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The scenario you want to achieve&lt;/li&gt;
&lt;li&gt;The problem you faced (incl. error messages)&lt;/li&gt;
&lt;li&gt;The code to reproduce the issue (IMPORTANT!)&lt;/li&gt;
&lt;li&gt;Environment (incl. OS, the version you used)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3f0ce5ce692c347fc95e74675e39ae90/60b6a/template.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQ4y5WTUW/DIAyE9/9/46a1SZuAScAQwEAIbESbKk1L1t2D3z75uDMvtVYien17u1wu75erVMosTbrJbNtWD1RKeam1xpQ45+M4WutCCN77GGNKKcZYSvkLjpFzDgBtrTFK4brm+pe+4Fqrc855X/+jL7iUMkvZdT2izjmfWP0V3hAVB3DOPUk+4BBC1/fDMHR9rxQ67217RJu2qaV4CKeUAAQIQUQUgvOeQiAiT+R3xRjP0u5vt/swtGZNa7j1jNosizHGWntmO6XEOLSyhGiNtSkYY4zzkbGjFh5pG7OAmKZ53o2HGFP+1lGEj5416uu1Y4wrROfcr488tN0sTxMAKIVTczDvCTaBEDnnM9taayGElBIAFrusOaeUdvuHF/6wba0VYhJiQtRpXXPOJ//pJ2yM6fobB5ilXPaGiOgpOMbYLmwc7/fBE23blvO27vufCgxAzLOcpURErbVCjYjnyz/hDz/uG3EfEh6wAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;template&quot;
        title=&quot;template&quot;
        src=&quot;/static/3f0ce5ce692c347fc95e74675e39ae90/f058b/template.png&quot;
        srcset=&quot;/static/3f0ce5ce692c347fc95e74675e39ae90/c26ae/template.png 158w,
/static/3f0ce5ce692c347fc95e74675e39ae90/6bdcf/template.png 315w,
/static/3f0ce5ce692c347fc95e74675e39ae90/f058b/template.png 630w,
/static/3f0ce5ce692c347fc95e74675e39ae90/40601/template.png 945w,
/static/3f0ce5ce692c347fc95e74675e39ae90/78612/template.png 1260w,
/static/3f0ce5ce692c347fc95e74675e39ae90/60b6a/template.png 1559w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;With enough information, the maintainers can start to find and fix the bugs without wasting time guessing your situation. Although it takes more effort from you, but it really saves lots of time comparing to leave insufficient information for the maintainers to figure out. I think it is a concept of “Help you to help me” and I recommend you to try to open a good quality issue and you will find your issue will be accepted and fix soon.&lt;/p&gt;
&lt;h2&gt;One more thing&lt;/h2&gt;
&lt;p&gt;If you still cannot get your problems fixed, don’t forget it is open source and you can always dive into the source code and find the solution all by yourself. It will take much more time, but you will learn a lot during the process, and don’t forget to create a PR if you have a good fix that can benefit others.&lt;/p&gt;
&lt;p&gt;Although these 3 things looks fundamental to do, but sometimes the basic way is the best, hope you find it useful next time you have a problem with an open source project.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[WebAssembly & Transferable, a Perfect Match]]></title><description><![CDATA[Most of the time, we run WebAssembly code inside a Web Worker (or worker_thread in Node.js) to prevent blocking the main thread and…]]></description><link>https://jeromewu.github.io/webassembly-transferable-a-perfect-match/</link><guid isPermaLink="false">https://jeromewu.github.io/webassembly-transferable-a-perfect-match/</guid><pubDate>Wed, 15 Jan 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2db7bbefb97351eeae1f8781bbd8ae86/6af66/banner.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQoz72STUsCURSG769o2R8JgjYFhm2CIKNIKowWhYFQVlAUgRlRtCmMNiFRuEmzQCcTTC1mERhEEgV9QKucaWacmTt37j0xDva1yRB6eeGc1eE87zmIMbAN8NnUKGQXxoBS+KsQ1CEU3lT9w1J4Q727MYNTyvSIlE8bAIxiAwgBZqm63U8ktOiTu5pLbocw4BT7HUJnUym+rwPURIFWZpS+NmHQKbrbxaEOsaflNZEAOM9Qlwc84/ThScbYjhFjbJomAGiaRiuz0dKkMtr9FvTLc2PS+kLZ6xIO4wCnSYoQNDTC88tVsZjPZjmO43k+lUrlcrlYLFYoFAghKDAh+9zS7TU5O8F8xtjbUqO7mrV2aAeSaQvVNDHGqqqalQZjrGmaruuMMTTvlXtbhe01NbRcXp1VAhPycaTK/Nvd0eUF4aI4eaBbjupHEf3x3gJjBoEK4VfZgX/EXt+dKQVqfjOj//Jh78VLy8XODn+bAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;banner&quot;
        title=&quot;banner&quot;
        src=&quot;/static/2db7bbefb97351eeae1f8781bbd8ae86/f058b/banner.png&quot;
        srcset=&quot;/static/2db7bbefb97351eeae1f8781bbd8ae86/c26ae/banner.png 158w,
/static/2db7bbefb97351eeae1f8781bbd8ae86/6bdcf/banner.png 315w,
/static/2db7bbefb97351eeae1f8781bbd8ae86/f058b/banner.png 630w,
/static/2db7bbefb97351eeae1f8781bbd8ae86/6af66/banner.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Most of the time, we run WebAssembly code inside a Web Worker (or worker_thread in Node.js) to prevent blocking the main thread and maintaining a responsive UI.&lt;/p&gt;
&lt;p&gt;To communicate with Web Worker, we use &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage&quot;&gt;Window.postMessage()&lt;/a&gt; to send data from main thread to web worker thread. Sometimes you may need to send megabytes of data (especially for multimedia applications) and it will result in long data transmission time and even out of memory exception due to the nature of postMessage() is to clone the data from main thread to web worker thread.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 471px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f93256128919b517bfb99f789097d619/1f09d/basic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQoz92RQUrEMBSGe0RP4SXEE4gncA4wghs3blz1AG0hUJpFKbQlpTSk0TTJZNLXPpGi1FEcZnDlv3y8j+/xv6Dv+zzPCSGU0jiO27aVUgIAfk2WZVEUEUKSJKGUpmkahmFgrQUA7z0AOOcQcZmsyWmalFLee+e8tfu9HxGxKIrAGHMgMcYcwACwXpvnGRHLsjwNfn502zv79LA7Di+GNXxzNVxevNxeD+eYtxt7v9kdMWutOedN0wghOOdSymF4tzk3v8rZmukHeLlTay2EYIzVdc0Yq6qq6zql1OfCb4V9f9XJbc8fQcRxHP/gVf8DfgN17yjwbg4GxQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;basic&quot;
        title=&quot;basic&quot;
        src=&quot;/static/f93256128919b517bfb99f789097d619/1f09d/basic.png&quot;
        srcset=&quot;/static/f93256128919b517bfb99f789097d619/c26ae/basic.png 158w,
/static/f93256128919b517bfb99f789097d619/6bdcf/basic.png 315w,
/static/f93256128919b517bfb99f789097d619/1f09d/basic.png 471w&quot;
        sizes=&quot;(max-width: 471px) 100vw, 471px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To solve this issue, you can use &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Transferable&quot;&gt;Transferable&lt;/a&gt; in postMessage(), simply pass second argument in postMessage() and you can get a speed up and memory saving without too much trouble.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Without Transerable, takes up to 2000 ms for worker to get data&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UInt8Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// With Transerable, takes up to 100 ms for worker to get data&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UInt8Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Check a demo in this repository: &lt;a href=&quot;https://github.com/jeromewu/web-worker-transferable-demo&quot;&gt;https://github.com/jeromewu/web-worker-transferable-demo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;As it is almost free to use Transferable and get speed up and memory saving in your application, you should start to use it in your application right now.&lt;/p&gt;
&lt;p&gt;See you in next story. :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How to use Gitpod in your create-react-app based project]]></title><description><![CDATA[Japanese Version (translated by Ryuichi Tanabe): https://qiita.com/baby-degu/items/bacf20f657625ae8747b Gitpod is a great online IDE and…]]></description><link>https://jeromewu.github.io/how-to-use-gitpod-in-your-create-react-app-based-project/</link><guid isPermaLink="false">https://jeromewu.github.io/how-to-use-gitpod-in-your-create-react-app-based-project/</guid><pubDate>Tue, 19 Nov 2019 12:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/05bd532f13413b6fdf4cb6a8dc95a58a/6af66/banner.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQoz52SzUrDQBDH+xyefQhPvofPoVfPIkX0WlCKCB68WAW1emnpxYJIUwWJSpVKTLKJDflY0jSbmZFs+mHTFsU/y+5h5r/zY2YKJIXTZ1aIlGA+VKA/CHDyBeCM2QNhir6TDEzR90HIPAQAGoGwMGlaUZhgvnKC2OD2pW/sWOq599kZ8LEnu5tmWHwMNu+9LcV9ceMMYWgeINS5VXbe1nWl1Ot0pVk3jErlDDFN22/rqyfq0tH72rVWfuoRkZD0qTlGuAmMC18v2uqpp71GPhGZjF1Vqxl5qaWtHN4tH7R2Ffv42clgR9iUYtcCq85ZjbMvEU2w5dNmwfZtd6PxsafYOo/H0YXdzjXMjcSDFQqcNyokAlkGhsWmR/UDZM6oflW2JPSPJVmkb24adZzgzNAwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;banner&quot;
        title=&quot;banner&quot;
        src=&quot;/static/05bd532f13413b6fdf4cb6a8dc95a58a/f058b/banner.png&quot;
        srcset=&quot;/static/05bd532f13413b6fdf4cb6a8dc95a58a/c26ae/banner.png 158w,
/static/05bd532f13413b6fdf4cb6a8dc95a58a/6bdcf/banner.png 315w,
/static/05bd532f13413b6fdf4cb6a8dc95a58a/f058b/banner.png 630w,
/static/05bd532f13413b6fdf4cb6a8dc95a58a/6af66/banner.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Japanese Version (translated by &lt;a href=&quot;https://medium.com/u/9724aaf6be6b?source=post_page-----dd4d0b33ce77--------------------------------&quot;&gt;Ryuichi Tanabe&lt;/a&gt;): &lt;a href=&quot;https://qiita.com/baby-degu/items/bacf20f657625ae8747b&quot;&gt;https://qiita.com/baby-degu/items/bacf20f657625ae8747b&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Gitpod is a great online IDE and here is how you can use in your create-react-app based project.&lt;/p&gt;
&lt;h2&gt;Why Gitpod?&lt;/h2&gt;
&lt;p&gt;Sometimes we just don’t want to spend time to prepare the development environment and start coding as soon as possible. Gitpod is a Github-integrated and 100 hours per month free use online IDE, it provides flexibility to customize your work space with &lt;code class=&quot;language-text&quot;&gt;.gitpod.yml&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f47d3f8c43c6cee79fd1ace7911abdde/d8104/htop.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVQoz23L2Y6bMBiGYe5hOizG/g0YE7yz2TDAZJmj9ihVJlXv/06qRK1UVZWeg1ef9EX1QVJB6jJXCFjFK14Vh6wBJHHJWEvbFlqsMT5AXbED5RXluUxxQ1lZsAgGCmNWdAmziPWo6jPoGTVZZVE5QLbV5MzKIycTgM1Il5IuLnRMbQomi8i3md8vcN3QdUu/7/R2Itev7Hbmn+f2x0f784PdT3B7Lz6P5f1En1Hcn65bZKTd1qNsZK0ccoPxi1M6jIsPoXG8cZxrVgvWmLpxvBZ1Y2quOVePPdLWrPsupaisfXFWL7OzNoTZBou6FzzFuE+wTfHwmvtXbBM8xniIcRfjPo6klG/rKoWotE6dU8NotPY+WG+xS6DPwCAQOSj0DPSIP6KKsSkEJUShFJ8mKYTSKvj5cbYxWEQYIRh+I38HiYwx+75rIUqtufdaKWPM+rb2S4f7L9ClhCGSY4L/I2pC0JcL8x7mme47m2c2z/J44scVLwK9d8nqk8kn/l/pOP4CljtXFNJ0riEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;htop&quot;
        title=&quot;htop&quot;
        src=&quot;/static/f47d3f8c43c6cee79fd1ace7911abdde/f058b/htop.png&quot;
        srcset=&quot;/static/f47d3f8c43c6cee79fd1ace7911abdde/c26ae/htop.png 158w,
/static/f47d3f8c43c6cee79fd1ace7911abdde/6bdcf/htop.png 315w,
/static/f47d3f8c43c6cee79fd1ace7911abdde/f058b/htop.png 630w,
/static/f47d3f8c43c6cee79fd1ace7911abdde/40601/htop.png 945w,
/static/f47d3f8c43c6cee79fd1ace7911abdde/78612/htop.png 1260w,
/static/f47d3f8c43c6cee79fd1ace7911abdde/d8104/htop.png 1365w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this story, we will talk about how to leverage Gitpod when you have a project based on create-react-app (or any react project).&lt;/p&gt;
&lt;h2&gt;Basic Configuration&lt;/h2&gt;
&lt;p&gt;In the basic configuration, we want to achieve following items:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;npm install&lt;/code&gt; when we create the work space&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;npm start&lt;/code&gt; every time we start the work space&lt;/li&gt;
&lt;li&gt;See preview every time we update the code&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To achieve all the features, you just need to add a &lt;code class=&quot;language-text&quot;&gt;.gitpod.yml&lt;/code&gt; with following content:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm install
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm start

&lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;onOpen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; open&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;preview&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is pretty self-explained and you can use it most of the projects easily.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;More options in &lt;a href=&quot;https://www.gitpod.io/docs/44_config_start_tasks/&quot;&gt;official docs&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Advanced Configuration&lt;/h2&gt;
&lt;p&gt;An advanced scenario is to use puppeteer for end-to-end testing in your create-react-app, by default some dependencies used by puppeteer is not installed in Gitpod default work space image (gitpod/workspace-full). So we need to extend the Docker image to make it work.&lt;/p&gt;
&lt;p&gt;Add &lt;code class=&quot;language-text&quot;&gt;.gitpod.Dockerfile&lt;/code&gt; in your repository:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; gitpod/workspace-full&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y libgtk-3-0 libx11-xcb1 libnss3 libxss1 libasound2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And update &lt;code class=&quot;language-text&quot;&gt;.gitpod.yml&lt;/code&gt; to use our &lt;code class=&quot;language-text&quot;&gt;.gitpod.Dockerfile&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .gitpod.Dockerfile

&lt;span class=&quot;token key atrule&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm install
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm start

&lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;onOpen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; open&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;preview&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Also you need to use &lt;code class=&quot;language-text&quot;&gt;--no-sandbox&lt;/code&gt; in jest-puppeteer, the full setup can be found here:&lt;/p&gt;
&lt;p&gt;Repository: &lt;a href=&quot;https://github.com/jeromewu/create-react-app-gitpod&quot;&gt;https://github.com/jeromewu/create-react-app-gitpod&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Gitpod: &lt;a href=&quot;https://gitpod.io/#https://github.com/jeromewu/create-react-app-gitpod&quot;&gt;https://gitpod.io/#https://github.com/jeromewu/create-react-app-gitpod&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;With full configuration, now you can have a working environment like below:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/70d4c80b16b17a579c031cfa78d51855/d8104/gitpod.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 49.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVQoz02QyW7bMBRF9ReNI5GiOM+UJYqUaMWyHSBpBnRRoJuu+gH9/3WhZJEeXOCtDu7Fq9an18u23W6P5217fnl6/v6yns/LaS3rQ1kf5qWklFNKOefT6ZTznHJOKcdpul5vVVmWcZwY5ZRR5ZW0QRgnjGfKCm2kUpxzjDEmRGqHZUCyR7KH1OS8VPM855S0MlRSckRGG6tt13UthO1/oA5zM0g3SRuVT0yPZb1W53Xd1jKMUWoVoleWy4EKxhFCoNkBYL8AttwMwkahR2Eit9H6sRqGIcaotVFGT2XSPqjeYSYQYYQxhNCHDmCLhDqy6QR+/+peX7iJLsTKOU8IZYwTQhpYA4gAbGHbQoRahCCEuwqaXRY9Ludvf/+Anz+YGlwYK+893V1BCG3qpv7ivq7rz9mf1Sbk47z582MolzCuro+V94FSzpj4CKeUSqmkkFJKxliHMYAQQIg6LG3UYZZpVWNRLrt+qoI1jBBGCKc0OHvs/dD74Kwx2ji7P/3+HtYHBIFQQeheqD1c9c71lS5P3XEj4wUPG+pPjVsaV2q73Jn5ziwHMx90PuhU24LzK85vOL+R+Y0t72Z9/we5RWWB+4hIngAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;gitpod&quot;
        title=&quot;gitpod&quot;
        src=&quot;/static/70d4c80b16b17a579c031cfa78d51855/f058b/gitpod.png&quot;
        srcset=&quot;/static/70d4c80b16b17a579c031cfa78d51855/c26ae/gitpod.png 158w,
/static/70d4c80b16b17a579c031cfa78d51855/6bdcf/gitpod.png 315w,
/static/70d4c80b16b17a579c031cfa78d51855/f058b/gitpod.png 630w,
/static/70d4c80b16b17a579c031cfa78d51855/40601/gitpod.png 945w,
/static/70d4c80b16b17a579c031cfa78d51855/78612/gitpod.png 1260w,
/static/70d4c80b16b17a579c031cfa78d51855/d8104/gitpod.png 1365w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;One more thing&lt;/h2&gt;
&lt;p&gt;If you are a VIM user like me, here is a small trick (maybe not the best) to use your VIM configuration in Gitpod with least effort.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .gitpod.Dockerfile

&lt;span class=&quot;token key atrule&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; wget https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//github.com/jeromewu/docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;workspace/raw/master/vim.zip &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;O /tmp/vim.zip &lt;span class=&quot;token important&quot;&gt;&amp;amp;&gt;&lt;/span&gt; /dev/null &lt;span class=&quot;token important&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; unzip /tmp/vim.zip &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;d /home/gitpod &lt;span class=&quot;token important&quot;&gt;&amp;amp;&gt;&lt;/span&gt; /dev/null
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; yarn install
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; yarn start

&lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;onOpen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; open&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;preview&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The concept here is to zip an existing VIM configuration, download and unzip to container, it saves lots of time to install but may not be a good option if you need to update your VIM configuration very often.&lt;/p&gt;
&lt;p&gt;In a word, using Gitpod for your Github project offers you a powerful environment to develop your project anytime and anywhere with ease. Hope you find this story useful and happy coding. 😃&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Speedup FFmpeg without compiling from source code]]></title><description><![CDATA[FFmpeg is a great tool when it comes to multimedia manipulation, by default it uses CPU with multi-thread to do the task which causes a high…]]></description><link>https://jeromewu.github.io/speedup-ffmpeg-without-compiling-from-source-code/</link><guid isPermaLink="false">https://jeromewu.github.io/speedup-ffmpeg-without-compiling-from-source-code/</guid><pubDate>Sun, 17 Nov 2019 12:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/33df75f3dd61ce426b147c8ccd6ae14a/eea4a/banner.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAehpWCFcX//EABsQAAIBBQAAAAAAAAAAAAAAAAECAwAEERMg/9oACAEBAAEFAhLIX2sKNzjj/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABwQAAEDBQAAAAAAAAAAAAAAAAIAASEDICJxgf/aAAgBAQAGPwJ40sqZcUgVn//EABkQAQEAAwEAAAAAAAAAAAAAAAERACAhUf/aAAgBAQABPyEjuTiS9yQ6nBOCfE0//9oADAMBAAIAAwAAABB/z//EABYRAQEBAAAAAAAAAAAAAAAAAAEQMf/aAAgBAwEBPxAJs//EABYRAQEBAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPxAMn//EABsQAQEAAgMBAAAAAAAAAAAAAAERADEQQXGB/9oACAEBAAE/EATI6ugDfivzI2gCildGDFYuwZ3w5//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;banner&quot;
        title=&quot;banner&quot;
        src=&quot;/static/33df75f3dd61ce426b147c8ccd6ae14a/828fb/banner.jpg&quot;
        srcset=&quot;/static/33df75f3dd61ce426b147c8ccd6ae14a/ff44c/banner.jpg 158w,
/static/33df75f3dd61ce426b147c8ccd6ae14a/a6688/banner.jpg 315w,
/static/33df75f3dd61ce426b147c8ccd6ae14a/828fb/banner.jpg 630w,
/static/33df75f3dd61ce426b147c8ccd6ae14a/0ede0/banner.jpg 945w,
/static/33df75f3dd61ce426b147c8ccd6ae14a/3ac88/banner.jpg 1260w,
/static/33df75f3dd61ce426b147c8ccd6ae14a/eea4a/banner.jpg 1280w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;FFmpeg is a great tool when it comes to multimedia manipulation, by default it uses CPU with multi-thread to do the task which causes a high loading to your PC and is kind of slow most of the time.&lt;/p&gt;
&lt;p&gt;If you google how to improve the speed of FFmpeg, you may find discussions about using &lt;code class=&quot;language-text&quot;&gt;-preset&lt;/code&gt; which lowers the compression ratio for higher speed (a trade-off between file size and speed) and another sexy approach is to leverage nVidia GPU (nvenc, nvdec and cuvid), but it it is not easy as:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You don’t own a compatible nVidia GPU card&lt;/li&gt;
&lt;li&gt;You need to install nVidia GPU drivers and CUDA (painful in Linux environment)&lt;/li&gt;
&lt;li&gt;You need to compile FFmpeg from source if you cannot find a ready-to-use version&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In my own experience, I spent hours to research how to install and compile FFmpeg, but fails in the end as my GPU is unable to support most of the features, that was sad.&lt;/p&gt;
&lt;p&gt;So is there any other way to make FFmpeg faster? Yes, and you can do that within seconds using VAAPI. Let’s do an experiment to see the differences.&lt;/p&gt;
&lt;h2&gt;Baseline: Scale a video without any options&lt;/h2&gt;
&lt;p&gt;Imagine you are creating a service to provide video streaming with different quality (720p, 1080p, etc.), so you need to scale down the uploaded video to different resolution.&lt;/p&gt;
&lt;p&gt;Let’s download a sample video from h264info and scale down without any options:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ffmpeg -i gravity.mp4 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -c:v libx264 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -s 1024x428 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -b:v 1M &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    out.mp4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It takes about 42 seconds (speed=3.5x) with 21 MB file size. (the original size is 355 MB)&lt;/p&gt;
&lt;h2&gt;With -preset to speedup with larger file size&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Check &lt;a href=&quot;https://trac.ffmpeg.org/wiki/Encode/H.264&quot;&gt;HERE&lt;/a&gt; for more details about preset&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Use preset, you can easily speed up FFmpeg with larger file size, which is acceptable when you have enough space left in your hard disk.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ffmpeg -i gravity.mp4 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -c:v libx264 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -preset ultrafast &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -s 1024x428 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -b:v 1M &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    out.mp4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It takes about 22 seconds (speed=6x) and with 20 MB file size. (Interesting, it is smaller than &lt;code class=&quot;language-text&quot;&gt;-preset default&lt;/code&gt; 😎)&lt;/p&gt;
&lt;h2&gt;With VAAPI to speedup with integrated/ Intel GPU card&lt;/h2&gt;
&lt;p&gt;Video Acceleration API (VAAPI) is not a secret in FFmpeg, but it is hard to notice how it can easily help you to speedup FFmpeg. The benefits of using VAAPI are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The integrated GPU card is cheap (and you already have one now)&lt;/li&gt;
&lt;li&gt;You only have to install i965-va-driver to make it work&lt;/li&gt;
&lt;li&gt;You don’t have to compile FFmpeg as this flag is enabled by default&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To use VAAPI in Ubuntu, first you need to install driver and check status with vainfo command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; i965-va-driver
$ vainfo
libva info: VA-API version &lt;span class=&quot;token number&quot;&gt;1.1&lt;/span&gt;.0
libva info: va_getDriverName&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; returns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
libva info: Trying to &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; /usr/lib/x86_64-linux-gnu/dri/i965_drv_video.so
libva info: Found init &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; __vaDriverInit_1_1
libva info: va_openDriver&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; returns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
vainfo: VA-API version: &lt;span class=&quot;token number&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;libva &lt;span class=&quot;token number&quot;&gt;2.1&lt;/span&gt;.0&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
vainfo: Driver version: Intel i965 driver &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; Intel&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Ivybridge Mobile - &lt;span class=&quot;token number&quot;&gt;2.1&lt;/span&gt;.0
vainfo: Supported profile and entrypoints
      VAProfileMPEG2Simple            &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileMPEG2Simple            &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointEncSlice
      VAProfileMPEG2Main              &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileMPEG2Main              &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointEncSlice
      VAProfileH264ConstrainedBaseline: VAEntrypointVLD
      VAProfileH264ConstrainedBaseline: VAEntrypointEncSlice
      VAProfileH264Main               &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileH264Main               &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointEncSlice
      VAProfileH264High               &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileH264High               &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointEncSlice
      VAProfileH264StereoHigh         &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileVC1Simple              &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileVC1Main                &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileVC1Advanced            &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD
      VAProfileNone                   &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVideoProc
      VAProfileJPEGBaseline           &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; VAEntrypointVLD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you see similar output like above, that means your Intel GPU card supports VAAPI, then you can use following command to scale:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ffmpeg -hwaccel vaapi &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -hwaccel_device /dev/dri/renderD129 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -hwaccel_output_format vaapi &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -i gravity.mp4 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -vf &lt;span class=&quot;token string&quot;&gt;&quot;scale_vaapi=w=1024:h=428&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -c:v h264_vaapi &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -b:v 1M &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    out.mp4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It takes about 10 seconds (speed=14.3x) and with 19 MB file size.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Put them altogether in a chart, using VAAPI can get the almost 4x speedup comparing to native and a little smaller file size as well.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1588dfe44a5d662aef1bc8ab19b63ede/0a47e/comparison.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVQoz4VSTWsTURTNLym4caEg1JUGsi6u1IWgKKgL60rQpS4kiEIXhq4FtYt2pYIQJfUTXERTUESkVhNtXZhEOzOZyYzpvHfnfsmbKTZFxcNbvK9z3jn33RIARFHkeV4QBL7vR1HkhzERFxAAQqQc+gdKzFwcsCix2/o+ZD+IAt+LomHW74We5/l+HMeqKmNwZEQEgFxI3JB8/A2yHY5MRMY6crONN55DkrKqsPwfm7YtZKo6UzeTl5JegKouLLMgCVM++xcZEdPUqupsw1aujPoumhb3NQ8g44adJBZyKrJlu9aw5erP7sdv6vdVJU75zRqvB0bThIlEnBFiKYrzO/Om7doilC8nK0eOJudOqUqrDbuqOnfhNpyYMmtfi5rxamcwfdw8W3QKRMXLjjz7CCrV5MPBw/HZY6ry+jOUa7owXUsrO237E6u+7elyY2l9z8Ro/qYjI5ZEJEP3zzMPYe/FZHnqwPDkIVVttWH3VZ07fd3s35F12qC67xqdOd8cTE6M5m85G5STU2MwsytduP/SW63XN5aaGdgfobnXGrx68GJQv2vD0AA+eTd8/PR9987CxpeOJSbE0vY+INSxDnGVJdxas6vaWHv+ArCXj0iugpKsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;comparison&quot;
        title=&quot;comparison&quot;
        src=&quot;/static/1588dfe44a5d662aef1bc8ab19b63ede/0a47e/comparison.png&quot;
        srcset=&quot;/static/1588dfe44a5d662aef1bc8ab19b63ede/c26ae/comparison.png 158w,
/static/1588dfe44a5d662aef1bc8ab19b63ede/6bdcf/comparison.png 315w,
/static/1588dfe44a5d662aef1bc8ab19b63ede/0a47e/comparison.png 600w&quot;
        sizes=&quot;(max-width: 600px) 100vw, 600px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In fact, if you invest time and effort to survey the nVidia GPU option you can have even more speedup, but it is still great to have speedups without too much effort and cost, isn’t it? 😄&lt;/p&gt;
&lt;p&gt;Hope you find this post useful and don’t hesitate to leave any responses or claps, thank you!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Build FFmpeg WebAssembly version (= ffmpeg.wasm): Part.4 ffmpeg.wasm v0.2 — Add Libx264]]></title><description><![CDATA[In this part you will learn: Add Libx264 to ffmpeg-core.js In browser ffmpeg.wasm demo Add Libx264 to ffmpeg-core.js For next step, we would…]]></description><link>https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-4-v0.2/</link><guid isPermaLink="false">https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-4-v0.2/</guid><pubDate>Thu, 31 Oct 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQoz52RsUrDUBSG+zCugg8guPoKQl9BAtVC0UWq7eTUJUhpohVzSzIkNIPQpTZDRUpxspChg0OTqEmT3phAenPvFZuaBlsc/MYD3zk//8nRH6I4uuryO9Xdk/uzvtYvn5fb7bZlWY7jQAh933ddNwgCmiFHKSWUUEqDebBX29+62D5Uj0VBLBwV+Gu+VCoxDFMsFvP5PMMwAABKaRzHG+TbocA+1i97NWc6tW3b8zzTNHsLDMMAAHQ6HUopxngl/5uVTChGcYQwwgQnu4MgkGU5DEOcYbO82kK+bUJIFEW6riOEkqhkQdbPpYI9G1nTJxhOljky+J9+HMeJvOEyQmgwPtX0g/GbNByMGo06z/OKokiSpKoqAIBl2QbHSZLEc1zyMJLKczQ3nJeJ/fzhvXYftJtm804QQKslSmJP02RZrlQrsqIIiyH0/STsUsYEO65tvZvQn623EIYhhPCvttcLS0v6NUzlL8i3UGQPK6VDAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ffmpeg wasm cover&quot;
        title=&quot;ffmpeg wasm cover&quot;
        src=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png&quot;
        srcset=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/c26ae/ffmpeg-wasm-cover.png 158w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6bdcf/ffmpeg-wasm-cover.png 315w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png 630w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this part you will learn:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Add Libx264 to ffmpeg-core.js&lt;/li&gt;
&lt;li&gt;In browser ffmpeg.wasm demo&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;Add Libx264 to ffmpeg-core.js&lt;/h2&gt;
&lt;p&gt;For next step, we would like to transcode an avi video and play it in our web browser. By default ffmpeg-core.js can transcode avi to mp4, but that mp4 file cannot be played in web browser as its encoding is not supported. So we need to add libx264 to our ffmpeg-core.js first.&lt;/p&gt;
&lt;p&gt;Below is the link to the x264 library we are going to add:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://code.videolan.org/videolan/x264&quot;&gt;https://code.videolan.org/videolan/x264&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;x264&lt;/code&gt; is much easier to build compared to ffmpeg, below are the key arguments you need to pass:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --host&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;i686-gnu                     &lt;span class=&quot;token comment&quot;&gt;# use i686 gnu&lt;/span&gt;
  --enable-static                     &lt;span class=&quot;token comment&quot;&gt;# enable building static library&lt;/span&gt;
  --disable-cli                       &lt;span class=&quot;token comment&quot;&gt;# disable cli tools&lt;/span&gt;
  --disable-asm                       &lt;span class=&quot;token comment&quot;&gt;# disable asm optimization&lt;/span&gt;
  --extra-cflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-s USE_PTHREADS=1&quot;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# pass this flags for using pthreads&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Check the repository for the full version of &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/blob/n4.3.1-p4/wasm/build-scripts/build-x264.sh&quot;&gt;build-x264.sh&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;While configuring ffmpeg, &lt;code class=&quot;language-text&quot;&gt;--enable-gpl&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;--enable-libx264&lt;/code&gt; flags must be added.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;CONFIG_ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --disable-inline-asm    &lt;span class=&quot;token comment&quot;&gt;# disable inline asm&lt;/span&gt;
  --disable-stripping     &lt;span class=&quot;token comment&quot;&gt;# disable stripping&lt;/span&gt;
  --disable-programs      &lt;span class=&quot;token comment&quot;&gt;# disable programs build (incl. ffplay, ffprobe &amp;amp; ffmpeg)&lt;/span&gt;
  --disable-doc           &lt;span class=&quot;token comment&quot;&gt;# disable doc&lt;/span&gt;
  --enable-gpl            &lt;span class=&quot;token comment&quot;&gt;## required by x264&lt;/span&gt;
  --enable-libx264        &lt;span class=&quot;token comment&quot;&gt;## enable x264&lt;/span&gt;
  --extra-cflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-cxxflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-ldflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LDFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${CONFIG_ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  -I. -I./fftools -I&lt;span class=&quot;token variable&quot;&gt;$BUILD_DIR&lt;/span&gt;/include
  -Llibavcodec -Llibavdevice -Llibavfilter -Llibavformat -Llibavresample -Llibavutil -Llibpostproc -Llibswscale -Llibswresample -L&lt;span class=&quot;token variable&quot;&gt;$BUILD_DIR&lt;/span&gt;/lib
  -Qunused-arguments
  -o wasm/dist/ffmpeg-core.js fftools/ffmpeg_opt.c fftools/ffmpeg_filter.c fftools/ffmpeg_hw.c fftools/cmdutils.c fftools/ffmpeg.c
  &lt;span class=&quot;token comment&quot;&gt;# Add -lpostproc and -lx264 below&lt;/span&gt;
  -lavdevice -lavfilter -lavformat -lavcodec -lswresample -lswscale -lavutil -lpostproc -lm -lx264 -pthread
  -O3                                           &lt;span class=&quot;token comment&quot;&gt;# Optimize code with performance first&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;USE_SDL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;                                  &lt;span class=&quot;token comment&quot;&gt;# use SDL2&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;USE_PTHREADS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;                             &lt;span class=&quot;token comment&quot;&gt;# enable pthreads support&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;PROXY_TO_PTHREAD&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;                         &lt;span class=&quot;token comment&quot;&gt;# detach main() from browser/UI main thread&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;INVOKE_RUN&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                               &lt;span class=&quot;token comment&quot;&gt;# not to run the main() in the beginning&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;EXPORTED_FUNCTIONS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[_main, _proxy_main]&quot;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# export main and proxy_main funcs&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;EXTRA_EXPORTED_RUNTIME_METHODS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[FS, cwrap, setValue, writeAsciiToMemory]&quot;&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;# export preamble funcs&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;INITIAL_MEMORY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;268435456&lt;/span&gt;                   &lt;span class=&quot;token comment&quot;&gt;## increase to 268435456 bytes = 256 MB&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emcc &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Check the repository for the full version of &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/blob/n4.3.1-p4/wasm/build-scripts/configure.sh&quot;&gt;configure.sh&lt;/a&gt; and &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/blob/n4.3.1-p4/wasm/build-scripts/build-ffmpeg.sh&quot;&gt;build-ffmpeg.sh&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;With all script in place, now you can build a ffmpeg.wasm with x264 (and potentially all other libraries.)&lt;/p&gt;
&lt;h2&gt;In browser ffmpeg.wasm demo&lt;/h2&gt;
&lt;p&gt;The final part of this story is a demo for ffmpeg.wasm v0.2, the scenario is to create a web page that enables user to upload a video file (ex. avi) and play inside the web browser. As it is not possible to play avi file directly, we will use ffmpeg.wasm to transcode the video first:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/3f49f83bb3354af398ab27f13db821ab/demo.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Below is the full HTML code (download sample video &lt;a href=&quot;https://github.com/ffmpegwasm/ffmpeg.wasm/raw/master/tests/assets/flame.avi&quot;&gt;HERE&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                                                                                                                                            
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                                                                                                                                          
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;style&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token style&quot;&gt;&lt;span class=&quot;token language-css&quot;&gt;                                                                                                                                       
      &lt;span class=&quot;token selector&quot;&gt;html, body&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;                                                       
        &lt;span class=&quot;token property&quot;&gt;margin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                                       
        &lt;span class=&quot;token property&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 100%&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                                     
        &lt;span class=&quot;token property&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 100%                                                     
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;                                                                  
      &lt;span class=&quot;token selector&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;                                                                                                                                      
        &lt;span class=&quot;token property&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; flex&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                                   
        &lt;span class=&quot;token property&quot;&gt;flex-direction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; column&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;align-items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; center&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                             
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;   
    &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;style&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                                                                                                                                      
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                                                                
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                                                                 
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Upload a video to transcode to mp4 (x264) and play!&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;video&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;output-video&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;controls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;video&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;br&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt; 
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;input&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;uploader&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                   
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Remeber to wait for 5 seconds for ffmpeg.wasm to load&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;span class=&quot;token language-javascript&quot;&gt;                                                                                                               
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;readFromBlobOrFile&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;blob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fileReader &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FileReader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          fileReader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onload&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fileReader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          fileReader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onerror&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; code &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;File could not be read! Code=&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;code&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          fileReader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readAsArrayBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;blob&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;message&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;transcode&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; files &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; files&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innerHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Writing file to MEMFS&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;readFromBlobOrFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;files&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                                                                          
        Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Uint8Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                                                                          
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ffmpeg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;proxy_main&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ffmpeg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-hide_banner&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-nostdin&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-report&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-i&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;out.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; argsPtr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; idx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;                                       
          &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                      
          Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeAsciiToMemory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                                                                                      
          Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argsPtr &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; idx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;i32&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                    
        message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innerHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Start to transcode&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                        
        &lt;span class=&quot;token function&quot;&gt;ffmpeg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; argsPtr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;/*                                                               
         * The execution of ffmpeg is not synchronized,                  
         * so we need to parse the log file to check if completed.
         */&lt;/span&gt;                                                              
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; timer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;               
          &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; logFileName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readdir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;endsWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.log&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; logFileName &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;undefined&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;                                                                                               
            &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; log &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromCharCode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logFileName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;frames successfully decoded&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token function&quot;&gt;clearInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                      
              message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innerHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Finish transcoding&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; out &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;out.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; video &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;output-video&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              video&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;src &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createObjectURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Blob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;video/mp4&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;                                                            
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;                                                         
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;uploader&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;change&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; transcode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                                                            
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./dist/ffmpeg-core.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;                         
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;It may take a long time to complete, you can open DevTools to see logs. Check &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/blob/n4.3.1-p4/wasm/transcode.html&quot;&gt;transcode.html&lt;/a&gt; to see how it works in action.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You can visit the repository here to see how it works in details: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p4&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p4&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And feel free to download the build artifacts here: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p4&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p4&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Here is a pause the this series of stories, hope you learnt how to build your own ffmpeg.wasm from scratch and potentially apply to any other libraries. See you next time! 😃&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Build FFmpeg WebAssembly version (= ffmpeg.wasm): Part.3 ffmpeg.wasm v0.1 — Transcoding avi to mp4]]></title><description><![CDATA[In this part you will learn: Build a library version of FFmpeg with optimized arguments. Interact with ffmpeg.wasm Manage Emscripten File…]]></description><link>https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-3-v0.1/</link><guid isPermaLink="false">https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-3-v0.1/</guid><pubDate>Mon, 21 Oct 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQoz52RsUrDUBSG+zCugg8guPoKQl9BAtVC0UWq7eTUJUhpohVzSzIkNIPQpTZDRUpxspChg0OTqEmT3phAenPvFZuaBlsc/MYD3zk//8nRH6I4uuryO9Xdk/uzvtYvn5fb7bZlWY7jQAh933ddNwgCmiFHKSWUUEqDebBX29+62D5Uj0VBLBwV+Gu+VCoxDFMsFvP5PMMwAABKaRzHG+TbocA+1i97NWc6tW3b8zzTNHsLDMMAAHQ6HUopxngl/5uVTChGcYQwwgQnu4MgkGU5DEOcYbO82kK+bUJIFEW6riOEkqhkQdbPpYI9G1nTJxhOljky+J9+HMeJvOEyQmgwPtX0g/GbNByMGo06z/OKokiSpKoqAIBl2QbHSZLEc1zyMJLKczQ3nJeJ/fzhvXYftJtm804QQKslSmJP02RZrlQrsqIIiyH0/STsUsYEO65tvZvQn623EIYhhPCvttcLS0v6NUzlL8i3UGQPK6VDAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ffmpeg wasm cover&quot;
        title=&quot;ffmpeg wasm cover&quot;
        src=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png&quot;
        srcset=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/c26ae/ffmpeg-wasm-cover.png 158w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6bdcf/ffmpeg-wasm-cover.png 315w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png 630w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this part you will learn:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Build a library version of FFmpeg with optimized arguments.&lt;/li&gt;
&lt;li&gt;Interact with ffmpeg.wasm&lt;/li&gt;
&lt;li&gt;Manage Emscripten File System.&lt;/li&gt;
&lt;li&gt;Develop ffmpeg.wasm v0.1 with transcoding feature.&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;Build a library version of FFmpeg with optimized arguments.&lt;/h2&gt;
&lt;p&gt;In Part.3, our goal is to create a basic ffmpeg.wasm v0.1 to transcode avi to mp4. As we only create a basic version of FFmpeg in Part.2, now we need to further optimized with few arguments.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-O3&lt;/code&gt; : optimize code and reduce code size (from 30 MB to 15 MB) (More details &lt;a href=&quot;https://emscripten.org/docs/optimizing/Optimizing-Code.html&quot;&gt;HERE&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-s PROXY_TO_PTHREAD=1&lt;/code&gt; : to make our program for responsive when using pthread (More details &lt;a href=&quot;https://emscripten.org/docs/porting/pthreads.html#additional-flags&quot;&gt;HERE&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-o wasm/dist/ffmpeg-core.js&lt;/code&gt; : rename ffmpeg.js to ffmpeg-core.js&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;(From here we call it ffmpeg-core.js as we will create a ffmpeg.js library to wrap the ffmpeg-core.js and provide user friendly APIs.)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-s EXPORTED_FUNCTIONS=&quot;[_main, _proxy_main]&quot;&lt;/code&gt; : export main() and proxy_main() (added by PROXY_TO_PTHREAD) C function to JavaScript world&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-s EXTRA_EXPORTED_RUNTIME_METHODS=&quot;[FS, cwrap, setValue, writeAsciiToMemory]&quot;&lt;/code&gt; : extra functions for manipulating functions, file system and pointers, check Interacting with code and preamble.js for more details.&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;For more details about these arguments, you can check src/settings.js in emscripten github repository.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;With all the new arguments, let’s update our &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-s USE_PTHREADS -O3&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;LDFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt; -s INITIAL_MEMORY=33554432&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 33554432 bytes = 32 MB&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CONFIG_ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --disable-inline-asm    &lt;span class=&quot;token comment&quot;&gt;# disable inline asm&lt;/span&gt;
  --disable-stripping     &lt;span class=&quot;token comment&quot;&gt;# disable stripping&lt;/span&gt;
  --disable-programs      &lt;span class=&quot;token comment&quot;&gt;# disable programs build (incl. ffplay, ffprobe &amp;amp; ffmpeg)&lt;/span&gt;
  --disable-doc           &lt;span class=&quot;token comment&quot;&gt;# disable doc&lt;/span&gt;
  --extra-cflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-cxxflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-ldflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LDFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${CONFIG_ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# build dependencies&lt;/span&gt;
emmake &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j4

&lt;span class=&quot;token comment&quot;&gt;# build ffmpeg.wasm&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p wasm/dist
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  -I. -I./fftools
  -Llibavcodec -Llibavdevice -Llibavfilter -Llibavformat -Llibavresample -Llibavutil -Llibpostproc -Llibswscale -Llibswresample
  -Qunused-arguments
  -o wasm/dist/ffmpeg.js fftools/ffmpeg_opt.c fftools/ffmpeg_filter.c fftools/ffmpeg_hw.c fftools/cmdutils.c fftools/ffmpeg.c
  -lavdevice -lavfilter -lavformat -lavcodec -lswresample -lswscale -lavutil -lm
  -O3                                           &lt;span class=&quot;token comment&quot;&gt;# Optimize code with performance first&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;USE_SDL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;                                  &lt;span class=&quot;token comment&quot;&gt;# use SDL2&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;USE_PTHREADS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;                             &lt;span class=&quot;token comment&quot;&gt;# enable pthreads support&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;PROXY_TO_PTHREAD&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;                         &lt;span class=&quot;token comment&quot;&gt;# detach main() from browser/UI main thread&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;INVOKE_RUN&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;                               &lt;span class=&quot;token comment&quot;&gt;# not to run the main() in the beginning&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;EXPORTED_FUNCTIONS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[_main, _proxy_main]&quot;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# export main and proxy_main funcs&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;EXTRA_EXPORTED_RUNTIME_METHODS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[FS, cwrap, setValue, writeAsciiToMemory]&quot;&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;# export preamble funcs&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;INITIAL_MEMORY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;33554432&lt;/span&gt;                    &lt;span class=&quot;token comment&quot;&gt;# 33554432 bytes = 32 MB&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emcc &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next, let’s try to interact with ffmpeg.wasm.&lt;/p&gt;
&lt;h2&gt;Interact with ffmpeg.wasm&lt;/h2&gt;
&lt;p&gt;To make sure our ffmpeg.wasm is working, let’s try to achieve following command in ffmpeg.wasm:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ffmpeg -hide_banner&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With &lt;code class=&quot;language-text&quot;&gt;-hide_banner&lt;/code&gt; argument, ffmpeg hides details about its version and build arguments, a typical output looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Hyper fast Audio and Video encoder
usage: ffmpeg [options] [[infile options] -i infile]... {[outfile options] outfile}...
Use -h to get full help or, even better, run &apos;man ffmpeg&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To begin with, let’s create a file called &lt;code class=&quot;language-text&quot;&gt;ffmpeg.js&lt;/code&gt; with following code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Module &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./dist/ffmpeg-core.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onRuntimeInitialized&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ffmpeg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;proxy_main&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The execution of the code above requires extra parameters in Node.JS:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt; --experimental-wasm-threads --experimental-wasm-bulk-memory ffmpeg.js&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Explanation for the functions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;onRuntimeInitialized&lt;/code&gt; : as WebAssembly requires some time to boot up, you need to wait for this function to be called before using the library.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cwrap&lt;/code&gt; : a wrapper function for the C function in JavaScript world. Here we wrap proxy_main() / main() function in &lt;code class=&quot;language-text&quot;&gt;fftools/ffmpeg.c&lt;/code&gt;. The function signature is &lt;code class=&quot;language-text&quot;&gt;int main(int argc, char **argv)&lt;/code&gt;, it is straightforward that &lt;code class=&quot;language-text&quot;&gt;int&lt;/code&gt; is mapping to &lt;code class=&quot;language-text&quot;&gt;number&lt;/code&gt; and as &lt;code class=&quot;language-text&quot;&gt;char **argv&lt;/code&gt; is a pointer in C, we can also mapping it to &lt;code class=&quot;language-text&quot;&gt;number&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then we need to pass the arguments to it. The equivalent argument for &lt;code class=&quot;language-text&quot;&gt;$ ffmpeg -hide_banner&lt;/code&gt; is &lt;code class=&quot;language-text&quot;&gt;main(2, [&quot;./ffmpeg&quot;, &quot;-hide_banner&quot;])&lt;/code&gt;. The first argument is easy, but how can we pass a string array? Let’s decompose the issue to two parts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We need to convert string in JavaScript to char array in C&lt;/li&gt;
&lt;li&gt;We need ot convert a number array in JavaScript to a pointer array in C&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The 1st part is easier as we have an utility function from Emscripten called &lt;code class=&quot;language-text&quot;&gt;writeAsciiToMemory()&lt;/code&gt; to help us, below is an example of using this function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;FFmpeg.wasm&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Allocate a memory with extra byte with value 0 to indicate the end of the string&lt;/span&gt;
Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeAsciiToMemory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The 2nd part is tricky, we need to create a pointer array in C with 32 bit integer as the pointer is in 32 bit integer. We need to use setValue here to create the array we need:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ptrs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3455&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ptrs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
ptrs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;p&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; idx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buf &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; idx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;i32&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Merge all the snippets above, now we can interact with ffmpeg.wasm and generate expected result:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Module &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./dist/ffmpeg-core&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onRuntimeInitialized&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ffmpeg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;proxy_main&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ffmpeg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-hide_banner&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; argsPtr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; idx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeAsciiToMemory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argsPtr &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; idx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;i32&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ffmpeg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; argsPtr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, we can interact with ffmpeg.wasm with ease, but how can we pass the video file to it? That is the focus of next section: File System.&lt;/p&gt;
&lt;h2&gt;Manage Emscripten File System.&lt;/h2&gt;
&lt;p&gt;In Emscripten, there is a virtual file system to support standard file read/write in C, thus we need to write our video file into this File System before passing the arguments to ffmpeg.wasm.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Find more details in &lt;a href=&quot;https://emscripten.org/docs/api_reference/Filesystem-API.html&quot;&gt;File System API&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Most of the time, there are only 2 FS functions you need to complete the task: &lt;code class=&quot;language-text&quot;&gt;FS.writeFile()&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;FS.readFile()&lt;/code&gt; .&lt;/p&gt;
&lt;p&gt;For all the data writing to or reading from the File System, it must be in Uint8Array type in JavaScript, remember to do type conversion before consuming the data.&lt;/p&gt;
&lt;p&gt;For this tutorial, let’s use a file called flame.avi (You can download it &lt;a href=&quot;https://github.com/ffmpegwasm/testdata/raw/master/flame.avi&quot;&gt;HERE&lt;/a&gt;) and read it with &lt;code class=&quot;language-text&quot;&gt;fs.readFileSync()&lt;/code&gt; and write it to Emscripten File System with &lt;code class=&quot;language-text&quot;&gt;FS.writeFile()&lt;/code&gt; .&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Module &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./dist/ffmpeg-core&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onRuntimeInitialized&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Uint8Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./flame.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;flame.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ffmpeg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;proxy_main&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ffmpeg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-hide_banner&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; argsPtr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; idx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeAsciiToMemory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argsPtr &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; idx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;i32&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ffmpeg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; argsPtr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Develop ffmpeg.wasm v0.1 with transcoding feature.&lt;/h2&gt;
&lt;p&gt;Now we are able to pass arguments to ffmpeg.wasm and save files to File System, let’s compose all of them together and get our ffmpeg.wasm v0.1 working.&lt;/p&gt;
&lt;p&gt;The last one more detail we need to be aware of is that &lt;code class=&quot;language-text&quot;&gt;ffmpeg()&lt;/code&gt; above is actually running asynchronously, so to get the output file we need to use a &lt;code class=&quot;language-text&quot;&gt;setInterval()&lt;/code&gt; to parse the log file to know if the tranding completes.&lt;/p&gt;
&lt;p&gt;Put everything together, now we have our first ffmpeg.wasm to transcode a avi file to mp4 file with any issues:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Module &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./dist/ffmpeg-core&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onRuntimeInitialized&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Uint8Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./flame.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;flame.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ffmpeg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;proxy_main&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;number&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ffmpeg&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-hide_banner&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-report&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;-i&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;flame.avi&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;flame.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; argsPtr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; idx&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buf &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_malloc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeAsciiToMemory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argsPtr &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Uint32Array&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BYTES_PER_ELEMENT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; idx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; buf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;i32&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;ffmpeg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; argsPtr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;/*
   * The execution of ffmpeg is not synchronized,
   * so we need to parse the log file to check if completed.
   */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; timer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; logFileName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readdir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;endsWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.log&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; logFileName &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;undefined&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; log &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromCharCode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logFileName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;frames successfully decoded&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;clearInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; output &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;flame.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;flame.mp4&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can visit the repository here to see how it works in details: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p3&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p3&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And feel free to download the build artifacts here: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p3&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p3&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Please note currently it is a Node.js only version, but we will develop a browser version in next post.&lt;/p&gt;
&lt;p&gt;Look forward to seeing you in Part.4. 😃&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Build FFmpeg WebAssembly version (= ffmpeg.wasm): Part.2 Compile with Emscripten]]></title><description><![CDATA[From here, things are going to be more complicated and hard to understand, you may need to google background knowledge if you don’t know…]]></description><link>https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-2-compile-with-emscripten/</link><guid isPermaLink="false">https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-2-compile-with-emscripten/</guid><pubDate>Sun, 13 Oct 2019 00:00:01 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQoz52RsUrDUBSG+zCugg8guPoKQl9BAtVC0UWq7eTUJUhpohVzSzIkNIPQpTZDRUpxspChg0OTqEmT3phAenPvFZuaBlsc/MYD3zk//8nRH6I4uuryO9Xdk/uzvtYvn5fb7bZlWY7jQAh933ddNwgCmiFHKSWUUEqDebBX29+62D5Uj0VBLBwV+Gu+VCoxDFMsFvP5PMMwAABKaRzHG+TbocA+1i97NWc6tW3b8zzTNHsLDMMAAHQ6HUopxngl/5uVTChGcYQwwgQnu4MgkGU5DEOcYbO82kK+bUJIFEW6riOEkqhkQdbPpYI9G1nTJxhOljky+J9+HMeJvOEyQmgwPtX0g/GbNByMGo06z/OKokiSpKoqAIBl2QbHSZLEc1zyMJLKczQ3nJeJ/fzhvXYftJtm804QQKslSmJP02RZrlQrsqIIiyH0/STsUsYEO65tvZvQn623EIYhhPCvttcLS0v6NUzlL8i3UGQPK6VDAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ffmpeg wasm cover&quot;
        title=&quot;ffmpeg wasm cover&quot;
        src=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png&quot;
        srcset=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/c26ae/ffmpeg-wasm-cover.png 158w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6bdcf/ffmpeg-wasm-cover.png 315w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png 630w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;From here, things are going to be more complicated and hard to understand, you may need to google background knowledge if you don’t know what happened (or you can leave responses to ask me).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Also, to make this tutorial more usable, I try to write down the details of how I solved each issue, hope it will help you in building the library of your choice.&lt;/p&gt;
&lt;p&gt;In this part you will learn:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;How to setup environment of Emscripten using Docker&lt;/li&gt;
&lt;li&gt;Usage of emconfigure and emmake&lt;/li&gt;
&lt;li&gt;How to fix issues when compiling FFmpeg with Emscripten&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;How to setup environment of Emscripten using Docker
In Build FFmpeg WebAssembly version (= ffmpeg.wasm): Part.1 Preparation, we have built the original version of FFmpeg with GCC, and now we move on to use Emscripten instead.&lt;/p&gt;
&lt;p&gt;The version of Emscripten we are going to use is 1.39.18 (trzeci/emscripten:1.39.18-upstream), you can install the Emscripten through the official tutorial (in this tutorial, we are setup-emsdk Github Actions in MacOS) or pull Emscripten image from docker hub.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; pull trzeci/emscripten:1.39.18-upstream&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;It may take few minutes as the size of the image is around 1 GB.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Then we need to update &lt;code class=&quot;language-text&quot;&gt;build-with-docker.sh&lt;/code&gt; like below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;EM_VERSION&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.39&lt;/span&gt;.18-upstream

&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; pull trzeci/emscripten:&lt;span class=&quot;token variable&quot;&gt;$EM_VERSION&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  -v &lt;span class=&quot;token environment constant&quot;&gt;$PWD&lt;/span&gt;:/src &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  -v &lt;span class=&quot;token environment constant&quot;&gt;$PWD&lt;/span&gt;/cache-wasm:/emsdk_portable/.data/cache/wasm &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  trzeci/emscripten:&lt;span class=&quot;token variable&quot;&gt;$EM_VERSION&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token string&quot;&gt;&apos;bash ./build.sh&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;cache-wasm is not required, but it can help you to speed up in subsequent build.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The next we are going to do is to find the configuration to build FFmpeg with emscripten, it is a try-and-error process and requires document digging and patient.&lt;/p&gt;
&lt;h2&gt;Usage of &lt;code class=&quot;language-text&quot;&gt;emconfigure&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;emmake&lt;/code&gt; &amp;#x26; How to fix issues when compiling FFmpeg with Emscripten&lt;/h2&gt;
&lt;p&gt;Let’s start our journey of finding the right configuration. In Part.1, it starts with &lt;code class=&quot;language-text&quot;&gt;./configure --disable-x86asm&lt;/code&gt;, to do it with emscripten, you need to change it to &lt;code class=&quot;language-text&quot;&gt;emconfigure ./configure --disable-x86asm&lt;/code&gt;. (For details of emconfigure, please check &lt;a href=&quot;https://emscripten.org/docs/compiling/Building-Projects.html#integrating-with-a-build-system&quot;&gt;HERE&lt;/a&gt;) And as we are doing cross compiling, we need to add cross-compiling flags to explicitly tell FFmpeg.&lt;/p&gt;
&lt;p&gt;Let’s update &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt; like below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And magically there is no error or anything wrong, so do we just need to type &lt;code class=&quot;language-text&quot;&gt;emmake make -j&lt;/code&gt; and we get FFmpeg.wasm? Unfortunately, the answer is no. One of the most important task for &lt;code class=&quot;language-text&quot;&gt;emconfigure&lt;/code&gt; is to replace the compiler from gcc to emcc (or g++ to em++), but in the output of &lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt;, we still get gcc as our compiler.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.38.45/system/bin/sdl2-config --cflags                            
emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.38.45/system/bin/sdl2-config --libs                               
install prefix            /usr/local                                                                                                   
source path               .                                                                                                                
C compiler                gcc             # Should be emcc                                                                                             
C library                 glibc                                                                                                           
ARCH                      x86 (generic)                                                                                                     
big-endian                no                                                                                                            
runtime cpu detection     yes                                                                                                         
standalone assembly       no                                                                                                            
x86 assembler             nasm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Every automation tool has its limitation and we need to do it manually in this case. Let’s check if there is any arguments to save us.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ./configure --help&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Under &lt;code class=&quot;language-text&quot;&gt;Toolchain options&lt;/code&gt;, there are arguments to assign the compiler to use.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;root@57ab95def750:/src# ./configure --help
Usage: configure [options]
Options: [defaults in brackets after descriptions]
Help options:
...
Toolchain options:                                                                                                             
...
  --nm=NM                  use nm tool NM [nm -g]
  --ar=AR                  use archive tool AR [ar]
  --as=AS                  use assembler AS []
  --ln_s=LN_S              use symbolic link tool LN_S [ln -s -f]
  --strip=STRIP            use strip tool STRIP [strip]
  --windres=WINDRES        use windows resource compiler WINDRES [windres]
  --x86asmexe=EXE          use nasm-compatible assembler EXE [nasm]
  --cc=CC                  use C compiler CC [gcc]
  --cxx=CXX                use C compiler CXX [g++]
  --objcc=OCC              use ObjC compiler OCC [gcc]
  --dep-cc=DEPCC           use dependency generator DEPCC [gcc]
  --nvcc=NVCC              use Nvidia CUDA compiler NVCC [nvcc]
  --ld=LD                  use linker LD []
…..&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s pass these arguments to compile with emscripten in &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;FLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${FLAGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;For native build, please make sure &lt;code class=&quot;language-text&quot;&gt;llvm-ranlib&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;llvm-as&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;llvm-nm&lt;/code&gt; exist. If not, you can find them in &lt;code class=&quot;language-text&quot;&gt;$EMSDK_ROOT/upstream/bin&lt;/code&gt; .&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;With these arguments the &lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt; will take more time to run, but you will get desired output in the end.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.39.18/system/bin/sdl2-config --cflags                            
emscripten sdl2-config called with /emsdk_portable/emscripten/tag-1.39.18/system/bin/sdl2-config --libs                                     
install prefix            /usr/local                                                                                                   
source path               .                                                                                                         
C compiler                emcc         # emcc as expected                                                                                    
C library                                                                                                                          
ARCH                      x86 (generic)                                                                                                     
big-endian                no                                                                                                              
runtime cpu detection     yes                                                                                                             
standalone assembly       no&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Add &lt;code class=&quot;language-text&quot;&gt;emmake make -j4&lt;/code&gt; (You can raise the parallelism to like &lt;code class=&quot;language-text&quot;&gt;-j8&lt;/code&gt; or simply use &lt;code class=&quot;language-text&quot;&gt;-j&lt;/code&gt; to use all cores) in the end of &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# build ffmpeg.wasm&lt;/span&gt;
emmake &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And it fails immediately after execution:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...
./libavutil/x86/timer.h:39:24: error: invalid output constraint &apos;=a&apos; in asm
                     : &quot;=a&quot; (a), &quot;=d&quot; (d));
                       ^&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From the output message, we can identify that the error is related to asm. Open &lt;code class=&quot;language-text&quot;&gt;./libavutil/x86/timer.h&lt;/code&gt; and we can confirm the issue is caused by the x86 inline assembly, which is not compatible with WebAssembly, so the solution is to disable it in &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --disable-inline-asm    &lt;span class=&quot;token comment&quot;&gt;# disable inline asm&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# build ffmpeg.wasm&lt;/span&gt;
emmake &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It works and keeps compiling until we hit another error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...
CC libavfilter/dnn/dnn_backend_native_layers.o
In file included from libavfilter/aeval.c:26:
In file included from ./libavutil/avassert.h:31:
In file included from ./libavutil/avutil.h:296:
In file included from ./libavutil/common.h:533:
In file included from ./libavutil/internal.h:176:
./libavutil/libm.h:54:32: error: static declaration of &apos;cbrt&apos; follows non-static declaration
static av_always_inline double cbrt(double x)
                               ^
/emsdk_portable/upstream/emscripten/system/include/libc/math.h:151:13: note: previous declaration is here
double      cbrt(double);
            ^
In file included from libavfilter/aeval.c:26:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This time the root cause is not so obvious, so we need to dig deeper inside what went wrong during the &lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt;. A very helpful file to check is &lt;code class=&quot;language-text&quot;&gt;ffbuild/config.log&lt;/code&gt;, it contains logs during &lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt; and most of time you can find the root cause there.&lt;/p&gt;
&lt;p&gt;By search &lt;code class=&quot;language-text&quot;&gt;cbrt&lt;/code&gt; inside &lt;code class=&quot;language-text&quot;&gt;config.log&lt;/code&gt;, we find error message below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...
check_mathfunc cbrt 1                                                         
test_ld cc                                                                     
test_cc                                                                       
BEGIN /tmp/ffconf.syfN4Irw/test.c                                             
1 #include &amp;lt;math.h&gt;                                                           
2 float foo(float f, float g) { return cbrt(f); }         
    3 int main(void){ return (int) foo; }                                     
END /tmp/ffconf.syfN4Irw/test.c                                               
emcc -D_ISOC99_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_POSIX_C_SOURCE=200112 -D_XOPEN_SOURCE=600 -std=c11 -fomit-frame-pointer -pthread -c -o /tmp/ffconf.syfN4Irw/test.o /tmp/ffconf.syfN4Irw/test.c         
emcc -Wl,-z,noexecstack -o /tmp/ffconf.syfN4Irw/test /tmp/ffconf.syfN4Irw/test.o
wasm-ld: error: &apos;atomics&apos; feature is used by /tmp/ffconf.syfN4Irw/test.o, so --shared-memory must be used
...                    &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This test tried to check if cbrt works in the environment, but it fails due to &lt;code class=&quot;language-text&quot;&gt;atomics&lt;/code&gt; feature errored. &lt;code class=&quot;language-text&quot;&gt;atomics&lt;/code&gt; is asked when you are using pthread, so let’s add &lt;code class=&quot;language-text&quot;&gt;pthread&lt;/code&gt; flags. (Check &lt;a href=&quot;https://emscripten.org/docs/porting/pthreads.html&quot;&gt;HERE&lt;/a&gt; for more details about pthread flags)&lt;/p&gt;
&lt;p&gt;Update &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-s USE_PTHREADS&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;LDFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --disable-inline-asm    &lt;span class=&quot;token comment&quot;&gt;# disable inline asm&lt;/span&gt;
  --extra-cflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-cxxflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-ldflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LDFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# build ffmpeg.wasm&lt;/span&gt;
emmake &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It works and keeps compiling until we hit another error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...
LD      ffplay_g                                                                                                                                  emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]                                                                                                           
7 warnings generated.                                                      
wasm-ld: error: initial memory too small, 19491744 bytes needed
...                    
make: *** [Makefile:114: ffplay_g] Error 1
make: *** Waiting for unfinished jobs....
emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec
:libavutil:libavresample` [-Wlinkflags]
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This time the issue is caused by too small in initial memory (by default only 16 MB in Emscripten, and here the minimal is 19+ MB), so we need to raise the initial memory to a higher value by passing &lt;code class=&quot;language-text&quot;&gt;-s INITIAL_MEMORY=33554432&lt;/code&gt; (32 MB).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-s USE_PTHREADS&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;LDFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt; -s INITIAL_MEMORY=33554432&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 33554432 bytes = 32 MB&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --disable-inline-asm    &lt;span class=&quot;token comment&quot;&gt;# disable inline asm&lt;/span&gt;
  --extra-cflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-cxxflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-ldflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LDFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# build ffmpeg.wasm&lt;/span&gt;
emmake &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Still there is an error after this fix:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;LD      ffplay_g
emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]
6 warnings generated.
LD      ffmpeg_g
emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]
9 warnings generated.
LD      ffprobe_g
emcc: warning: ignoring unsupported linker flag: `-rpath-link=:libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample` [-Wlinkflags]
STRIP   ffmpeg
strip:ffmpeg_g: file format not recognized
make: *** [Makefile:107: ffmpeg] Error 1
make: *** Waiting for unfinished jobs....&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As we are unable to strip (make sense as it is not in a valid binary format), let’s simply disable strip with &lt;code class=&quot;language-text&quot;&gt;--disable-stripping&lt;/code&gt; and make again:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-s USE_PTHREADS&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;LDFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt; -s INITIAL_MEMORY=33554432&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 33554432 bytes = 32 MB&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --disable-inline-asm    &lt;span class=&quot;token comment&quot;&gt;# disable inline asm&lt;/span&gt;
  --disable-stripping     &lt;span class=&quot;token comment&quot;&gt;# disable stripping&lt;/span&gt;
  --extra-cflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-cxxflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-ldflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LDFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# build ffmpeg.wasm&lt;/span&gt;
emmake &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally we managed to successfully do the &lt;code class=&quot;language-text&quot;&gt;emmake make -j&lt;/code&gt; part and you can see ffplay / ffplay_g, ffprobe / ffprobe_g and ffmpeg / ffmpeg_g generated in the root folder. It looks perfect, but there is a weird _g suffix makes the output files like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ffmpeg&lt;/li&gt;
&lt;li&gt;ffmpeg_g&lt;/li&gt;
&lt;li&gt;ffmpeg_g.wasm&lt;/li&gt;
&lt;li&gt;ffmpeg_g.worker.js&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Both ffmpeg and ffmpeg_g here are actualy js files, the ideal naming is like below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ffmpeg / ffmpeg_g =&gt; ffmpeg.js&lt;/li&gt;
&lt;li&gt;ffmpeg_g.wasm =&gt; ffmpeg.wasm&lt;/li&gt;
&lt;li&gt;ffmpeg_g.worker.js =&gt; ffmpeg.worker.js&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To fix this issue, we need to build it by our own. The command to build ffmpeg can be extracted by running &lt;code class=&quot;language-text&quot;&gt;emmake make -n&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...
printf &quot;LD\t%s\n&quot; ffmpeg_g; emcc -Llibavcodec -Llibavdevice -Llibavfilter -Llibavformat -Llibavresample -Llibavutil -Llibpostproc -Llibswscale -Llibswresample -Wl,--as-needed -Wl,-z,noexecstack -Wl,--warn-common -Wl,-rpath-link=libpostproc:libswresample:libswscale:libavfilter:libavdevice:libavformat:libavcodec:libavutil:libavresample -Qunused-arguments   -o ffmpeg_g fftools/ffmpeg_opt.o fftools/ffmpeg_filter.o fftools/ffmpeg_hw.o fftools/cmdutils.o fftools/ffmpeg.o  -lavdevice -lavfilter -lavformat -lavcodec -lswresample -lswscale -lavutil  -lm -pthread -lm -lm -pthread -lm -lm -lm -pthread -lm
printf &quot;CP\t%s\n&quot; ffmpeg; cp -p ffmpeg_g ffmpeg
…..&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With a little clean up:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;emcc \
  -I. -I./fftools \
  -Llibavcodec -Llibavdevice -Llibavfilter -Llibavformat -Llibavresample -Llibavutil -Llibpostproc -Llibswscale -Llibswresample \
  -Qunused-arguments \
  -o ffmpeg_g fftools/ffmpeg_opt.o fftools/ffmpeg_filter.o fftools/ffmpeg_hw.o fftools/cmdutils.o fftools/ffmpeg.o \
  -lavdevice -lavfilter -lavformat -lavcodec -lswresample -lswscale -lavutil -lm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As we are building our own version, let’s add &lt;code class=&quot;language-text&quot;&gt;--disable-programs&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;--disable-doc&lt;/code&gt; in &lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt; step to speed up the build and also add some essential flags when build ffmpeg&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# verify Emscripten version&lt;/span&gt;
emcc -v

&lt;span class=&quot;token comment&quot;&gt;# configure FFMpeg with Emscripten&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-s USE_PTHREADS&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;LDFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt; -s INITIAL_MEMORY=33554432&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 33554432 bytes = 32 MB&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CONFIG_ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  --target-os&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;none        &lt;span class=&quot;token comment&quot;&gt;# use none to prevent any os specific configurations&lt;/span&gt;
  --arch&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_32           &lt;span class=&quot;token comment&quot;&gt;# use x86_32 to achieve minimal architectural optimization&lt;/span&gt;
  --enable-cross-compile  &lt;span class=&quot;token comment&quot;&gt;# enable cross compile&lt;/span&gt;
  --disable-x86asm        &lt;span class=&quot;token comment&quot;&gt;# disable x86 asm&lt;/span&gt;
  --disable-inline-asm    &lt;span class=&quot;token comment&quot;&gt;# disable inline asm&lt;/span&gt;
  --disable-stripping     &lt;span class=&quot;token comment&quot;&gt;# disable stripping&lt;/span&gt;
  --disable-programs      &lt;span class=&quot;token comment&quot;&gt;# disable programs build (incl. ffplay, ffprobe &amp;amp; ffmpeg)&lt;/span&gt;
  --disable-doc           &lt;span class=&quot;token comment&quot;&gt;# disable doc&lt;/span&gt;
  --extra-cflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-cxxflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --extra-ldflags&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LDFLAGS&lt;/span&gt;&quot;&lt;/span&gt;
  --nm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;llvm-nm -g&quot;&lt;/span&gt;
  --ar&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emar
  --as&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
  --ranlib&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib
  --cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --cxx&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;em++
  --objcc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
  --dep-cc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;emcc
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emconfigure ./configure &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${CONFIG_ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# build dependencies&lt;/span&gt;
emmake &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j4

&lt;span class=&quot;token comment&quot;&gt;# build ffmpeg.wasm&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p wasm/dist
&lt;span class=&quot;token assign-left variable&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  -I. -I./fftools
  -Llibavcodec -Llibavdevice -Llibavfilter -Llibavformat -Llibavresample -Llibavutil -Llibpostproc -Llibswscale -Llibswresample
  -Qunused-arguments
  -o wasm/dist/ffmpeg.js fftools/ffmpeg_opt.c fftools/ffmpeg_filter.c fftools/ffmpeg_hw.c fftools/cmdutils.c fftools/ffmpeg.c
  -lavdevice -lavfilter -lavformat -lavcodec -lswresample -lswscale -lavutil -lm
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;USE_SDL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;                    &lt;span class=&quot;token comment&quot;&gt;# use SDL2&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;USE_PTHREADS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;               &lt;span class=&quot;token comment&quot;&gt;# enable pthreads support&lt;/span&gt;
  -s &lt;span class=&quot;token assign-left variable&quot;&gt;INITIAL_MEMORY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;33554432&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;# 33554432 bytes = 32 MB&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
emcc &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${ARGS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;@&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;}&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s create a &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/blob/n4.3.1-p2/wasm/basic.html&quot;&gt;basic.html&lt;/a&gt; to test if ffmpeg.wasm is working:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token doctype&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;!&lt;/span&gt;&lt;span class=&quot;token doctype-tag&quot;&gt;DOCTYPE&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;en&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;UTF-8&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./dist/ffmpeg.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Run a lightweight web server (ex. &lt;code class=&quot;language-text&quot;&gt;python3 -m http.server 3000&lt;/code&gt;) and visit the web page (ex. &lt;a href=&quot;http://localhost:3000/basic.html&quot;&gt;http://localhost:3000/basic.html&lt;/a&gt;) and open the Chrome DevTools.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3b546c69d78cf5ea27677d9dae1afa6f/dc61a/output.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQY03WQ6W6DMBCEef8nqxoMhCRNQw6ThmIuH7GNDwylNakqVWql78doNavZnUB2AJcha2KCQoJWuHwmaMXqiCDQ3p5YHbMq4l2qeWZEZuXRikyLY1XEnByCHie0jiXZUgRoHUmyc+oymtxp6NTFKWjlyU80HHXuMbntzy1aS5YFmsasSazIeLvmXTqoyzyV81jM4/tvim+mclB5kYesewkUjWgV92wv8Ebzw6ihd7jbv4zFoCC6RXf8Goh2RRCgFSBV6DT0sW5JcA/+WNbivCTvg54AgbeSbHiXGpHNw9tkr/5DA0cNP7z75+ZFTO9WweIK/Nk9iTne3JukpzuOU9Gl9yax8uSLlUfne1ow+UNMJjfyXBXJV9ufpkCDhRzQGX4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;output&quot;
        title=&quot;output&quot;
        src=&quot;/static/3b546c69d78cf5ea27677d9dae1afa6f/f058b/output.png&quot;
        srcset=&quot;/static/3b546c69d78cf5ea27677d9dae1afa6f/c26ae/output.png 158w,
/static/3b546c69d78cf5ea27677d9dae1afa6f/6bdcf/output.png 315w,
/static/3b546c69d78cf5ea27677d9dae1afa6f/f058b/output.png 630w,
/static/3b546c69d78cf5ea27677d9dae1afa6f/40601/output.png 945w,
/static/3b546c69d78cf5ea27677d9dae1afa6f/dc61a/output.png 1147w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It is kind of working as you can see output similar to original FFmpeg, it gives us a good starting point to polish our ffmpeg.wasm library.&lt;/p&gt;
&lt;p&gt;You can visit the repository here to see how it works in details: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p2&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And feel free to download the build artifacts here: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p2&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p2&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;For how to polish and create a “real” ffmpeg.wasm library, please see next post in this series of stories. 😃&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Build FFmpeg WebAssembly version (= ffmpeg.wasm): Part.1 Preparation]]></title><description><![CDATA[In this part you will learn: The background of this series How to build native FFmpeg with Docker (and without docker in MacOS) The…]]></description><link>https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-1-preparation/</link><guid isPermaLink="false">https://jeromewu.github.io/build-ffmpeg-webassembly-version-part-1-preparation/</guid><pubDate>Sun, 13 Oct 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQoz52RsUrDUBSG+zCugg8guPoKQl9BAtVC0UWq7eTUJUhpohVzSzIkNIPQpTZDRUpxspChg0OTqEmT3phAenPvFZuaBlsc/MYD3zk//8nRH6I4uuryO9Xdk/uzvtYvn5fb7bZlWY7jQAh933ddNwgCmiFHKSWUUEqDebBX29+62D5Uj0VBLBwV+Gu+VCoxDFMsFvP5PMMwAABKaRzHG+TbocA+1i97NWc6tW3b8zzTNHsLDMMAAHQ6HUopxngl/5uVTChGcYQwwgQnu4MgkGU5DEOcYbO82kK+bUJIFEW6riOEkqhkQdbPpYI9G1nTJxhOljky+J9+HMeJvOEyQmgwPtX0g/GbNByMGo06z/OKokiSpKoqAIBl2QbHSZLEc1zyMJLKczQ3nJeJ/fzhvXYftJtm804QQKslSmJP02RZrlQrsqIIiyH0/STsUsYEO65tvZvQn623EIYhhPCvttcLS0v6NUzlL8i3UGQPK6VDAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ffmpeg wasm cover&quot;
        title=&quot;ffmpeg wasm cover&quot;
        src=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png&quot;
        srcset=&quot;/static/899a0ba50105cb44cf23fe8cc40b8e42/c26ae/ffmpeg-wasm-cover.png 158w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6bdcf/ffmpeg-wasm-cover.png 315w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/f058b/ffmpeg-wasm-cover.png 630w,
/static/899a0ba50105cb44cf23fe8cc40b8e42/6af66/ffmpeg-wasm-cover.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this part you will learn:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The background of this series&lt;/li&gt;
&lt;li&gt;How to build native FFmpeg with Docker (and without docker in MacOS)&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;The background of this series&lt;/h2&gt;
&lt;p&gt;This series of stories aim to serve following purposes:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A guide for people who want to learn how to use Emscripten to compile a C/C++ library to JavaScript (Hopefully the most useful and detailed so far)&lt;/li&gt;
&lt;li&gt;Personal notes&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Why FFmpeg?&lt;/h2&gt;
&lt;p&gt;FFmpeg is a free and open-source project consisting of a vast software suite of libraries and programs for handling video, audio, and other multimedia files and streams. (from Wikipedia)&lt;/p&gt;
&lt;p&gt;It is an useful library and there is no JavaScript library with exactly the same capabilities. If you google “ffmpeg.js”, you will find few existing libraries exactly the same as what we are going to build:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ffmpeg.js: &lt;a href=&quot;https://github.com/Kagami/ffmpeg.js&quot;&gt;https://github.com/Kagami/ffmpeg.js&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;videoconverter.js: &lt;a href=&quot;https://github.com/bgrins/videoconverter.js&quot;&gt;https://github.com/bgrins/videoconverter.js&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These libraries are great and ready-to-use in most cases, but they are suffering from following issues:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The versions of both FFmpeg and Emscripten are out-dated.&lt;/li&gt;
&lt;li&gt;Not under active maintenance for years. (Kagami/ffmpeg.js continues its development in April 2020)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I considered to take over maybe one of the repositories, but as there are too many changes these years, I decided to do it from scratch and wrote this series of tutorial at the same time to help people to learn how to use Emscripten in a real world C/C++ library.&lt;/p&gt;
&lt;h2&gt;How to build native FFmpeg with Docker&lt;/h2&gt;
&lt;p&gt;To start with, we need to clone FFmpeg source code from its repository, as the master branch is under development, it is better we choose a specific release to compile.&lt;/p&gt;
&lt;p&gt;At the moment I wrote the story, the latest stable version of FFmpeg is n4.3.1, so we will use this version through out the stories.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Use depth=1 to download only the latest version&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone --depth &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; --branch n4.3.1 https://github.com/FFmpeg/FFmpeg&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After completing cloning the repository, it is time to build with GCC to make sure it works.&lt;/p&gt;
&lt;p&gt;Actually you can skip this part if you are in a rush, but in my own experience it is better to get used to the build system of library first.&lt;/p&gt;
&lt;p&gt;The instruction of building and installing FFmpeg can be found inside &lt;a href=&quot;https://github.com/FFmpeg/FFmpeg/blob/n4.3.1/INSTALL.md&quot;&gt;INSTALL.md&lt;/a&gt; in the root of the repository:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Installing FFmpeg:
1. Type `./configure` to create the configuration. A list of configure options is printed by running `configure -help`.
`configure` can be launched from a directory different from the FFmpeg sources to build the objects out of tree. To do this, use an absolute path when launching `configure`, e.g. `/ffmpegdir/ffmpeg/configure`.
2. Then type `make` to build FFmpeg. GNU Make 3.81 or later is required.
3. Type `make install` to install all binaries and libraries you built.
NOTICE
 - - -
- Non system dependencies (e.g. libx264, libvpx) are disabled by default.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As we don’t need to actually install the FFmpeg, only step 1 and 2 are required.&lt;/p&gt;
&lt;p&gt;There are two ways to build, one is native way which requires you to install packages (ex. emsdk, Node.js). Most of time it works, but sometimes you may face bugs that is hard to resolve due to the variation of package versions and operating system. Another way is to use Docker, which provides a stable and static build environments. It is highly recommended to use Docker as it saves your time to install (and remove) the packages.&lt;/p&gt;
&lt;p&gt;I will not cover how to install the packages here, but as I split the scripts into &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;build-with-docker.sh&lt;/code&gt; , you can install all the packages yourself and run &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;To make sure this tutorial can achieve maximum coverage of environments, I use Github Actions to test if it works on Linux and MacOS. For Linux users, I will use Docker way / &lt;code class=&quot;language-text&quot;&gt;build-with-docker.sh&lt;/code&gt; to build. For MacOS users, as Docker is not supported in Github Actions, I will use native way / &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt; to build.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Now, let’s create a file called &lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt; with following content.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# gcc 8 is used in this tutorial, other versions may fail&lt;/span&gt;
./configure --disable-x86asm
&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To build in native way, you can simply run command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt; build.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To build with Docker, create a file called &lt;code class=&quot;language-text&quot;&gt;build-with-docker.sh&lt;/code&gt; with following content:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash -x&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; pull gcc:8
&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  -v &lt;span class=&quot;token environment constant&quot;&gt;$PWD&lt;/span&gt;:/usr/src &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  gcc:8 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token string&quot;&gt;&apos;cd /usr/src &amp;amp;&amp;amp; bash build.sh&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And run command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt; build-with-docker.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--disable-x86asm&lt;/code&gt; is required to disable x86 assemble features as we are not going to use it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Depend on the speed of you Internet and the hardware specification of your computer, it may take 10~30 minutes to complete the compilation.
And it is normal that you see tons of warnings during compilation as gcc 9 introduces more constrains.&lt;/p&gt;
&lt;p&gt;It should take some time to compile the native FFmpeg. If everything is OK, you should be able to run &lt;code class=&quot;language-text&quot;&gt;ffmpeg&lt;/code&gt; with following command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ./ffmpeg&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ffmpeg version n4.3.1 Copyright © 2000–2019 the FFmpeg developers
built with gcc 8 (GCC)
configuration: — disable-x86asm
libavutil 56. 22.100 / 56. 22.100
libavcodec 58. 35.100 / 58. 35.100
libavformat 58. 20.100 / 58. 20.100
libavdevice 58. 5.100 / 58. 5.100
libavfilter 7. 40.101 / 7. 40.101
libswscale 5. 3.100 / 5. 3.100
libswresample 3. 3.100 / 3. 3.100
Hyper fast Audio and Video encoder
usage: ffmpeg [options] [[infile options] -i infile]… {[outfile options] outfile}…
Use -h to get full help or, even better, run ‘man ffmpeg’&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can visit the repository here to see how it works in details: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p1&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/tree/n4.3.1-p1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And feel free to download the build artifacts here: &lt;a href=&quot;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p1&quot;&gt;https://github.com/ffmpegwasm/FFmpeg/releases/tag/n4.3.1-p1&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Now we have completed the preparation, let’s move on to next post to start compiling FFmpeg with Emscripten. 😃&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Why I refactor tesseract.js v2?]]></title><description><![CDATA[After almost 2 years of maintaining tesseract.js, I have to say tesseract.js hit its limitation as some of the issues from users are hard to…]]></description><link>https://jeromewu.github.io/why-i-refactor-tesseract.js-v2/</link><guid isPermaLink="false">https://jeromewu.github.io/why-i-refactor-tesseract.js-v2/</guid><pubDate>Thu, 03 Oct 2019 12:00:00 GMT</pubDate><content:encoded>&lt;p&gt;After almost 2 years of maintaining tesseract.js, I have to say tesseract.js hit its limitation as some of the issues from users are hard to fix, especially those related to performance.&lt;/p&gt;
&lt;p&gt;The existing tesseract.js (before v2.0.0-alpha) offers declarative and coarse-grained APIs that minimize the effort to understand the complex design of the library, it hides details like how tesseract.js loads *.traineddata from remote, how the *.traineddata is saved to local file system or IndexDB as cache, how the WebAssembly version of tesseract-ocr is initialed with parameters, set the image and generated the result we desired. It is great and everyone is happy to get a turn-key OCR library to integrate into your project.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Typical usage of tesseract.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; TesseractWorker &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Tesseract
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; worker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TesseractWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; image &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://tesseract.projectnaptha.com/img/eng_bw.png&quot;&lt;/span&gt;
worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;recognize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; text &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But as you use tesseract.js more and more in your project, you figure out the performance is not so good. It feels like every time you call recognize(), tesseract.js always starts from scratch and loads the *.traineddata, initializes its core and set the parameters again and again. It really takes lots of time and the performance becomes unsatisfied.&lt;/p&gt;
&lt;p&gt;Another issue is that every time you want to do something that tesseract-ocr can do with tesseract.js, it fails immediately and you totally don’t know how to solve it, so you create an issue and cross your finger hope someone can save you, but most of the time, the miracle doesn’t happen. So you dive into the source code and find out it is really complicated and twisted inside, in the end you may give up or email the active maintainers of the tesseract.js and wait for the reply.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;So I decided to refactor tesseract.js and after few weeks it is almost done (released as v2.0.0-beta.1) and I would like to share with you the major changes:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;tesseract.js-core (WebAssembly version of tesseract-ocr) is now upgraded using tesseract-ocr v4.1 and emscripten 1.38.45 fastcomp (upstream is not stable enough to compile tesseract-ocr)&lt;/li&gt;
&lt;li&gt;Refactor APIs to be more readable, imperative and fine-grained (we will cover this part later)&lt;/li&gt;
&lt;li&gt;Support scheduling to execute multiple OCR tasks at the same time&lt;/li&gt;
&lt;li&gt;Support typescript with index.d.ts&lt;/li&gt;
&lt;li&gt;Rewrite documents (especially docs/api.md)
And below is how it looks right now:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// tesseract.js@^2.0.0-beta.1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createWorker &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;tesseract.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; image &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://tesseract.projectnaptha.com/img/eng_bw.png&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; worker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;loadLanguage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;eng&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;eng&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token literal-property property&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; text &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;recognize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It may feel kind of weird to see that you need to do more things in the new version, but with more lines of code you have more in-depth control of tesseract.js and boost the performance of your project. A possible use case is like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createWorker &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;tesseract.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; image &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://tesseract.projectnaptha.com/img/eng_bw.png&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; worker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; isReady &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Called as early as possible&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;loadLanguage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;eng&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;eng&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  isReady &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Do other stuffs&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;img&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isReady&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token literal-property property&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; text &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;recognize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The benefit is that you can prepare the worker as early as possible to improve the overall user experience.&lt;/p&gt;
&lt;p&gt;Another important feature is that we add scheduling capabilities for you to use multiple workers at the same time. It is useful when you have enough resource (CPU cores) for your project to decrease the time for massive recognition jobs.&lt;/p&gt;
&lt;p&gt;Below is a sample code for using scheduler with 4 workers to handle 10 recognition jobs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createWorker&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; createScheduler &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;tesseract.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; image &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;https://tesseract.projectnaptha.com/img/eng_bw.png&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; scheduler &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createScheduler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; w &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;loadLanguage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;eng&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;eng&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    scheduler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; rets &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    scheduler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addJob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;recognize&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rets&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; text &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; scheduler&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;terminate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The role of scheduler is to manage the job queue and worker pool and distribute jobs any idle workers.&lt;/p&gt;
&lt;p&gt;A performance comparison between alpha version and beta version can be found below (using Node version in a 8 core machine).&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/676838fb00bebc7e57f5dd43d5b31284/0a47e/performance.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxElEQVQoz21STVMTQRDNv+Hm6kmC8U+hB9dDNoEURsqvX2B54CRoILFIeaRKKBKvUKUIVilEdmKShZ2dnZ7dnmlrdheIxq4+zJv+eK9nupQkCWPM9/0gCMbjybk/HP4eB8HlZDK5uAyDi5ANR+c+G41GcRzT31YiojRNpZQZNNcBY8w0zG+mrSg2xmhtwaev+GYneb2jesdIRCdM7x2le0f4nWn6p9M0sxBWUnU9vu3yW4/CZtsKWXovHTd03LDRkkQG9QyzUgpRI9reK1twfym6V+OvuoqIVjtQqfNKnT/7AESkZ6hLjDEhhASb3WjJhVo0X+XPt232ky0oe1HZi1Y7QGSSVKdoHXWuoWBGzNo2NmGhFt2t8hfbtlezDfMeL3s8K/4fMxEhYhzbIVc2ZS77ZddmP21DpR5V6jkzvd2HxTWxuCbWe1aINqZ47ZzZ24A7jyPHjZpZ9nILHJc7Ll9uWVjdgLmHfO4Br70rhBTFUsokUV9ORWf3R2f357czoVH1D391e9Z7BwNM4fPh4GN/0N0/7R+cJQoQsTTzeZh5bhpEoERApLMtyUM6O1zNfG3a3Hi+FaBSCYm52j40hPpmW/4ATjeDnC13YA8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Tesseract.js v2 performance&quot;
        title=&quot;Tesseract.js v2 performance&quot;
        src=&quot;/static/676838fb00bebc7e57f5dd43d5b31284/0a47e/performance.png&quot;
        srcset=&quot;/static/676838fb00bebc7e57f5dd43d5b31284/c26ae/performance.png 158w,
/static/676838fb00bebc7e57f5dd43d5b31284/6bdcf/performance.png 315w,
/static/676838fb00bebc7e57f5dd43d5b31284/0a47e/performance.png 600w&quot;
        sizes=&quot;(max-width: 600px) 100vw, 600px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Source code: &lt;a href=&quot;https://github.com/jeromewu/tesseract.js-performance&quot;&gt;https://github.com/jeromewu/tesseract.js-performance&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;With 4 workers we can have a almost 3x speed up (from 60s to 20s), it is possible to speed up with even more workers!&lt;/p&gt;
&lt;p&gt;If you are interested in using tesseract and giving feedback, please visit &lt;a href=&quot;https://github.com/naptha/tesseract.js&quot;&gt;tesseract.js github&lt;/a&gt; and try it with following command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ npm install tesseract.js@next&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Hope you enjoy tesseract.js and thanks for reading this post. :)&lt;/p&gt;</content:encoded></item></channel></rss>