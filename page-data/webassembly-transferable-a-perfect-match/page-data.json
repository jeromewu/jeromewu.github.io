{"componentChunkName":"component---src-templates-blog-post-js","path":"/webassembly-transferable-a-perfect-match/","result":{"data":{"site":{"siteMetadata":{"title":"TechBlog"}},"markdownRemark":{"id":"d7e2184b-c669-5803-acba-7284395436b8","excerpt":"Most of the time, we run WebAssembly code inside a Web Worker (or worker_thread in Node.js) to prevent blocking the main thread and maintaining a responsive UIâ€¦","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2db7bbefb97351eeae1f8781bbd8ae86/6af66/banner.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQoz72STUsCURSG769o2R8JgjYFhm2CIKNIKowWhYFQVlAUgRlRtCmMNiFRuEmzQCcTTC1mERhEEgV9QKucaWacmTt37j0xDva1yRB6eeGc1eE87zmIMbAN8NnUKGQXxoBS+KsQ1CEU3lT9w1J4Q727MYNTyvSIlE8bAIxiAwgBZqm63U8ktOiTu5pLbocw4BT7HUJnUym+rwPURIFWZpS+NmHQKbrbxaEOsaflNZEAOM9Qlwc84/ThScbYjhFjbJomAGiaRiuz0dKkMtr9FvTLc2PS+kLZ6xIO4wCnSYoQNDTC88tVsZjPZjmO43k+lUrlcrlYLFYoFAghKDAh+9zS7TU5O8F8xtjbUqO7mrV2aAeSaQvVNDHGqqqalQZjrGmaruuMMTTvlXtbhe01NbRcXp1VAhPycaTK/Nvd0eUF4aI4eaBbjupHEf3x3gJjBoEK4VfZgX/EXt+dKQVqfjOj//Jh78VLy8XODn+bAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"banner\"\n        title=\"banner\"\n        src=\"/static/2db7bbefb97351eeae1f8781bbd8ae86/f058b/banner.png\"\n        srcset=\"/static/2db7bbefb97351eeae1f8781bbd8ae86/c26ae/banner.png 158w,\n/static/2db7bbefb97351eeae1f8781bbd8ae86/6bdcf/banner.png 315w,\n/static/2db7bbefb97351eeae1f8781bbd8ae86/f058b/banner.png 630w,\n/static/2db7bbefb97351eeae1f8781bbd8ae86/6af66/banner.png 640w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Most of the time, we run WebAssembly code inside a Web Worker (or worker_thread in Node.js) to prevent blocking the main thread and maintaining a responsive UI.</p>\n<p>To communicate with Web Worker, we use <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\">Window.postMessage()</a> to send data from main thread to web worker thread. Sometimes you may need to send megabytes of data (especially for multimedia applications) and it will result in long data transmission time and even out of memory exception due to the nature of postMessage() is to clone the data from main thread to web worker thread.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 471px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f93256128919b517bfb99f789097d619/1f09d/basic.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQoz92RQUrEMBSGe0RP4SXEE4gncA4wghs3blz1AG0hUJpFKbQlpTSk0TTJZNLXPpGi1FEcZnDlv3y8j+/xv6Dv+zzPCSGU0jiO27aVUgIAfk2WZVEUEUKSJKGUpmkahmFgrQUA7z0AOOcQcZmsyWmalFLee+e8tfu9HxGxKIrAGHMgMcYcwACwXpvnGRHLsjwNfn502zv79LA7Di+GNXxzNVxevNxeD+eYtxt7v9kdMWutOedN0wghOOdSymF4tzk3v8rZmukHeLlTay2EYIzVdc0Yq6qq6zql1OfCb4V9f9XJbc8fQcRxHP/gVf8DfgN17yjwbg4GxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"basic\"\n        title=\"basic\"\n        src=\"/static/f93256128919b517bfb99f789097d619/1f09d/basic.png\"\n        srcset=\"/static/f93256128919b517bfb99f789097d619/c26ae/basic.png 158w,\n/static/f93256128919b517bfb99f789097d619/6bdcf/basic.png 315w,\n/static/f93256128919b517bfb99f789097d619/1f09d/basic.png 471w\"\n        sizes=\"(max-width: 471px) 100vw, 471px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>To solve this issue, you can use <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Transferable\">Transferable</a> in postMessage(), simply pass second argument in postMessage() and you can get a speed up and memory saving without too much trouble.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Without Transerable, takes up to 2000 ms for worker to get data</span>\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UInt8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nworker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// With Transerable, takes up to 100 ms for worker to get data</span>\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UInt8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nworker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Check a demo in this repository: <a href=\"https://github.com/jeromewu/web-worker-transferable-demo\">https://github.com/jeromewu/web-worker-transferable-demo</a></p>\n<p>As it is almost free to use Transferable and get speed up and memory saving in your application, you should start to use it in your application right now.</p>\n<p>See you in next story. :)</p>","frontmatter":{"title":"WebAssembly & Transferable, a Perfect Match","date":"January 15, 2020","description":"Use transferable in Webassembly to save memory usage"}},"previous":{"fields":{"slug":"/how-to-use-gitpod-in-your-create-react-app-based-project/"},"frontmatter":{"title":"How to use Gitpod in your create-react-app based project"}},"next":{"fields":{"slug":"/3-things-you-should-do-to-quickly-fix-your-problem-in-an-open-source-project/"},"frontmatter":{"title":"3 Things you should do to quickly fix your problem in a open source project"}}},"pageContext":{"id":"d7e2184b-c669-5803-acba-7284395436b8","previousPostId":"39e0cf06-26d0-54f5-bddd-397580a6d397","nextPostId":"ea537423-f0f0-5913-a26b-cd34489b033d"}},"staticQueryHashes":["2841359383","3257411868"]}